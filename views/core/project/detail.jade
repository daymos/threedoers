
extends ../base

block title
  |  Your Project

block body

  .container_block
    section.homepage.container2
      p#title.title(data-type="text", data-url="/project/title/#{project.id}", data-title="Enter the Title") #{project.title}
      .images_data
        .frame-1
        .frame-2
        .file
          canvas#cv
        p#message-canvas.messages.hide
          | It seems you are using an outdated browser that does not support canvas :-(
        .container_background

      .parameters.processing-volume(class=(project.status!=1)?"hide":"")
        p.objects
          | OBJECT VOLUME:
          span.object-volume
            span#volume &nbsp;#{project.volume}
            &nbsp
            span#unit #{project.unit}
            &nbsp
            sup 3
        //
          /todo manca immagine di status

        p.status
          | STATUS:
          span#status &nbsp;#{project.humanizedStatus()}
        -if (!project.editable && project.order)
          p.order.hide
            | PRICE:
            span#order-placed-order  #{project.order.price}

  - if (project.status == statuses.PROCESSING[0] || project.status == statuses.PROCESSED[0])
    .block_configuration_form.row
      section.homepage.container2
        .form_group1
          //
            /todo manca value dal backend

          select#color-chooser.selectpicker
            option(selected='selected', disabled='disabled') SELECT A COLOR *
            - for color in colors
              option(value="#{color}") #{color}

          select#density-chooser.selectpicker
            option(selected='selected', disabled='disabled') SELECT A DENSITY *
            - for density in densities
              option(value="#{density[0]}") #{density[1]}

        .form_group2.well
          form.form-horizontal(action='/project/order/#{project.id}', method='POST', role='form', accept-charset='utf-8', name='')
            input(type='hidden', name='authenticity_token')
            .block1
              .left
                input(type='hidden', name='_csrf', value=csrfToken)
                input#ammount.form(type='number', min='1', placeholder='HOW MANY ITEMS? *', name='ammount')
              .right
                input#ammount.form(type='number', min='1', placeholder='HOW MANY ITEMS? *', name='ammount')
            .block2
              .price
                span.order
                  | ORDER PRICE:
                  span#order-price  Processing
                  span  $
              .submit
                input#submit.form(type='submit', value='PLACE ORDER', name='submit')

      .configuration_background
        .background

      // if user same as owner and status payed
      - if (project.status == statuses.PRINT_ACCEPTED[0] && user.id == project.user)
        a(href="/project/pay/#{project.id}").btn.btn-lg.btn-primary.pull-right Pay Order
        .clearfix

      - if (project.status == statuses.PAYED[0])
        .row
          form.form-inline(role="form", action="/project/start-printing/#{project.id}", method="post").col-md-12
            input(type='hidden', name='_csrf', value=csrfToken)
            input(type="submit", value="Print Order").btn.btn-primary.pull-right

      - if (project.status == statuses.PRINTING[0])
        .row
          form.form-inline(role="form", action="/project/printed/#{project.id}", method="post").col-md-12
            input(type='hidden', name='_csrf', value=csrfToken)
            input(type="submit", value="Order Printed").btn.btn-primary.pull-right

      - if (project.status >= statuses.PRINT_ACCEPTED[0])  // if project was accepted
        h5 Comments

        ul#comment-list.list-group
          - for comment in project.comments
            li.list-group-item
              .row
                .col-xs-2.col-md-1
                  img.img-circle.img-responsive(src='http://placehold.it/80', alt='')
                .col-xs-10.col-md-11
                  div
                    .mic-info
                      | By: &nbsp; &nbsp;
                      a(href='#') #{comment.username}
                      | &nbsp;on #{comment.createdAt}
                  br
                  .comment-text
                    | #{comment.content}


        textarea#comment-text.comment.col-md-12
        .clearfix
        br
        button.btn.btn-primary.pull-right#comment-button Comment

block extra-headers
  meta(name="csrf-token", content="#{csrfToken}")

block scripts
  script(type='text/javascript', src='/js/lib/jquery.jeditable.js')
  script(type='text/javascript', src='/js/views/project_detail.js')
  script(type='text/javascript', src='/vendor/jsc3d.min.js')
  script(type='text/javascript', src='/vendor/socket.io.min.js')
  script.
    var project = {
      id: "#{project._id}",
      filename: "#{project.file}",
      color: "#{project.color?project.color:'black'}",
      density: "#{project.density}"
    };
    var port = "#{io.port}";
