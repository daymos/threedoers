(function(){var e,t,n,r,a,i,o,s;s=function(e){var t,n,r;r=[];for(n in e)t=$("#"+n),1===t.length&&t.text(" "+e[n]),"status"===n&&("processing"===e[n]?($(".object-volume-unit").addClass("hide"),$(".object-volume").text("processing")):$(".object-volume-unit").removeClass("hide")),"order"===n&&$("#order-placed-order").text(" "+e[n].price+"  "),"status_image"===n?r.push($("#status-image").attr("src","/img/icons_"+e[n]+"_second.png")):r.push(void 0);return r},t={black:"#000000",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",yellow:"#FFFF00"},n=function(e){return o[e]||e},r=function(e){return e.replace(/[&<>]/g,n)},o={"&":"&amp;","<":"&lt;",">":"&gt;"},e=null,i=null,a=null,$(document).ready(function(){var n,o,c,l,u,d;n="X-CSRF-Token",c=function(e){return jQuery.ajaxPrefilter(function(t,r,a){return a.crossDomain?void 0:a.setRequestHeader(n,e)})},c($('meta[name="csrf-token"]').attr("content"));try{l=io.connect(":"+port+"/project")}catch(f){o=f,console.log({query:{project:window.location.pathname.split("/").pop()}}),l=io.connect(":"+port+"/project",{query:"project="+window.location.pathname.split("/").pop()})}return l.on("error",function(e){return console.log(e.msg)}),l.on("update",function(e){return l.emit("order-price",{ammount:$("#ammount").val()}),s(e)}),l.on("update-price-order",function(e){return $("#order-price").text(e.price)}),Modernizr.canvas||$("#message-canvas").removeClass("hide"),d=new JSC3D.Viewer($("#cv").get(0)),d.setParameter("SceneUrl","/"+project.filename),d.setParameter("ModelColor",""+t[project.color]),d.setParameter("BackgroundColor1","#E5D7BA"),d.setParameter("BackgroundColor2","#383840"),d.setParameter("RenderMode","smooth"),d.setParameter("Definition","high"),d.setParameter("MipMapping","on"),d.setParameter("CreaseAngle","30"),d.onloadingcomplete=function(){return project.hasImage?void 0:setTimeout(function(){return $.post("/project/"+project.id+"/image/",{image:$("#cv")[0].toDataURL()})},15e3)},d.init(),d.update(),$("#color-chooser").val(""+project.color),$("#color-chooser").val(""+project.color).change(function(){return $.post("/project/color/"+project.id,{value:$(this).val()},function(){return location.reload()})}),$("#material-chooser").val(""+project.material),$("#material-chooser").val(""+project.material).change(function(){return $.post("/project/material/"+project.id,{value:$(this).val()})}),$("#title").editable("/project/title/"+project.id),$("#ammount").keyup(function(e){return(/\D/g.test(this.value)||/^0$/.test(this.value))&&(this.value=this.value.replace(/\D/g,""),this.value=this.value.replace(/^0$/,"")),/^[1-9][0-9]*$/.test(this.value)||/^\s*$/.test(this.value)?($("#order-price").text("Processing"),l.emit("order-price",{ammount:$("#ammount").val()})):e.preventDefault()}),$("#comment-button").click(function(e){return e.preventDefault(),$.ajax({url:"/project/comment/"+project.id,method:"post",dataType:"json",data:{message:$("#comment-text").val()},success:function(e){var t;return t="<div class='media'><a href='#' class='pull-left'><img src='/"+e.photo+"' alt='' class='media-object' height='78' width='78'></a>              <div class='media-body'>                <p>"+r(e.content)+"</p>              </div>              <div class='media-meta'>by <span class='author'>"+e.username+"</span> <span class='date'>"+Date(e.createdAt)+"</span></div>            </div>",$("#comment-list").append($(t)),$("#comment-text").val("")},statusCode:{400:function(e){return e=JSON.parse(e.responseText),alert(e.msg)}}})}),u=function(){return e?$.ajax({url:"/validate-address-and-rate/"+project.id,data:e,dataType:"json",success:function(t){var n;if(t.errors)for(n in t.errors)alert(""+t.errors[n].param+": "+t.errors[n].msg);return t.message&&alert(t.message),t.ok?(e=t.address,i=parseFloat(t.charge),$("#address-selection").hide(),$("#pay-values").show(),$("#pay-product-price").html(""+project.orderPrice),$("#pay-shipping-price").html(""+i),$("#pay-total-price").html(""+(project.orderPrice+i).toFixed(2))):alert("Something was wrong please try again.")},error:function(){return alert("Something was wrong please try again.")}}):alert("Please select and address or add new one.")},$("a.select-saved-address").click(function(t){return t.preventDefault(),e={id:$(this).attr("data-id")},u()}),$("button#validate-address").click(function(t){var n;return t.preventDefault(),e={},n=$(this).closest("form").serializeArray(),$.each(n,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),u()}),$("#payment-form").submit(function(e){var t;return e.preventDefault(),t=$("#payment-form"),a=t.find("input[name=shipping]:checked").val(),"shipping"===a?$("#payment-modal").modal("show"):($("#hidden-pay-form #shippingMethod").val(a),$("#hidden-pay-form").submit())}),$(".close-payment-modal").click(function(){return $("#payment-modal").modal("hide")}),$("#payment-modal").on("hidden.bs.modal",function(){return $("#address-selection").show(),$("#pay-values").hide(),e=null,a=null,i=null}),$("#pay-payment-modal").click(function(){return $("#hidden-pay-form #shippingRate").val(i),$("#hidden-pay-form #shippingMethod").val(a),$("#hidden-pay-form #shippingAddress").val(JSON.stringify(e)),$("#hidden-pay-form").submit()})})}).call(this);