function HomeController(){var t=this;$("#btn-logout").click(function(){t.attemptLogout()}),$("#account-form-btn1").click(function(){$(".modal-confirm").modal("show")}),$(".modal-confirm .submit").click(function(){t.deleteAccount()}),this.deleteAccount=function(){$(".modal-confirm").modal("hide");var t=this;$.ajax({url:"/delete",type:"POST",data:{id:$("#userId").val()},success:function(){t.showLockedAlert("Your account has been deleted.<br>Redirecting you back to the homepage.")},error:function(t){console.log(t.responseText+" :: "+t.statusText)}})},this.attemptLogout=function(){var t=this;$.ajax({url:"/home",type:"POST",data:{logout:!0},success:function(){t.showLockedAlert("You are now logged out.<br>Redirecting you back to the homepage.")},error:function(t){console.log(t.responseText+" :: "+t.statusText)}})},this.showLockedAlert=function(t){$(".modal-alert").modal({show:!1,keyboard:!1,backdrop:"static"}),$(".modal-alert .modal-header h3").text("Success!"),$(".modal-alert .modal-body p").html(t),$(".modal-alert").modal("show"),$(".modal-alert button").click(function(){window.location.href="/"}),setTimeout(function(){window.location.href="/"},3e3)}}function LoginController(){$("#login-form #forgot-password").click(function(){$("#get-credentials").modal("show")}),$("#get-credentials").on("shown",function(){$("#email-tf").focus()}),$("#get-credentials").on("hidden",function(){$("#user-tf").focus()})}function SignupController(){$("#account-form-btn1").click(function(){window.location.href="/"}),$(".modal-alert #ok").click(function(){setTimeout(function(){window.location.href="/"},300)})}function UploadController(){$(document).addEventListener("DOMContentLoaded",function(){var t=io.connect(),e=new SocketIOFileUpload(t);document.getElementById("upload_btn").addEventListener("click",e.prompt,!1),e.listenOnInput(document.getElementById("upload_input")),e.listenOnDrop(document.getElementById("file_drop")),e.addEventListener("complete",function(t){console.log(t.success),console.log(t.file)})},!1)}function AccountValidator(){this.formFields=[$("#name-tf"),$("#email-tf"),$("#user-tf"),$("#pass-tf")],this.controlGroups=[$("#name-cg"),$("#email-cg"),$("#user-cg"),$("#pass-cg")],this.alert=$(".modal-form-errors"),this.alert.modal({show:!1,keyboard:!0,backdrop:!0}),this.validateName=function(t){return t.length>=3},this.validatePassword=function(t){return $("#userId").val()&&""===t?!0:t.length>=6},this.validateEmail=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},this.showErrors=function(t){$(".modal-form-errors .modal-body p").text("Please correct the following problems :");var e=$(".modal-form-errors .modal-body ul");e.empty();for(var a=0;t.length>a;a++)e.append("<li>"+t[a]+"</li>");this.alert.modal("show")}}function EmailValidator(){var t=this;t.retrievePassword=$("#get-credentials"),t.retrievePassword.modal({show:!1,keyboard:!0,backdrop:!0}),t.retrievePasswordAlert=$("#get-credentials .alert"),t.retrievePassword.on("show",function(){$("#get-credentials-form").resetForm(),t.retrievePasswordAlert.hide()})}function ResetValidator(){this.setPassword=$("#set-password"),this.setPassword.modal({show:!1,keyboard:!1,backdrop:"static"}),this.setPasswordAlert=$("#set-password .alert")}function extractPageName(t){var e=t.split("/");return 2>e.length?t:e[e.length-2].toLowerCase()+e[e.length-1].toLowerCase()}function setActiveMenu(t,e){for(var a=0;t.length>a;a++)extractPageName(t[a].href)==e&&"DIV"!=t[a].parentNode.tagName&&(t[a].className="current",t[a].parentNode.className="current")}function setPage(){hrefString=document.location.href?document.location.href:document.location,null!=document.getElementById("nav")&&setActiveMenu(document.getElementById("nav").getElementsByTagName("a"),extractPageName(hrefString))}HomeController.prototype.onUpdateSuccess=function(){$(".modal-alert").modal({show:!1,keyboard:!0,backdrop:!0}),$(".modal-alert .modal-header h3").text("Success!"),$(".modal-alert .modal-body p").html("Your account has been updated."),$(".modal-alert").modal("show"),$(".modal-alert button").off("click")},AccountValidator.prototype.showInvalidEmail=function(){this.controlGroups[1].addClass("error"),this.showErrors(["That email address is already in use."])},AccountValidator.prototype.showInvalidUserName=function(){this.controlGroups[2].addClass("error"),this.showErrors(["That username is already in use."])},AccountValidator.prototype.validateForm=function(){for(var t=[],e=0;this.controlGroups.length>e;e++)this.controlGroups[e].removeClass("error");return 0==this.validateName(this.formFields[0].val())&&(this.controlGroups[0].addClass("error"),t.push("Please Enter Your Name")),0==this.validateEmail(this.formFields[1].val())&&(this.controlGroups[1].addClass("error"),t.push("Please Enter A Valid Email")),0==this.validateName(this.formFields[2].val())&&(this.controlGroups[2].addClass("error"),t.push("Please Choose A Username")),0==this.validatePassword(this.formFields[3].val())&&(this.controlGroups[3].addClass("error"),t.push("Password Should Be At Least 6 Characters")),t.length&&this.showErrors(t),0===t.length},EmailValidator.prototype.validateEmail=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},EmailValidator.prototype.showEmailAlert=function(t){this.retrievePasswordAlert.attr("class","alert alert-error"),this.retrievePasswordAlert.html(t),this.retrievePasswordAlert.show()},EmailValidator.prototype.hideEmailAlert=function(){this.retrievePasswordAlert.hide()},EmailValidator.prototype.showEmailSuccess=function(t){this.retrievePasswordAlert.attr("class","alert alert-success"),this.retrievePasswordAlert.html(t),this.retrievePasswordAlert.fadeIn(500)},ResetValidator.prototype.validatePassword=function(t){return t.length>=6?!0:(this.showAlert("Password Should Be At Least 6 Characters"),!1)},ResetValidator.prototype.showAlert=function(t){this.setPasswordAlert.attr("class","alert alert-error"),this.setPasswordAlert.html(t),this.setPasswordAlert.show()},ResetValidator.prototype.hideAlert=function(){this.setPasswordAlert.hide()},ResetValidator.prototype.showSuccess=function(t){this.setPasswordAlert.attr("class","alert alert-success"),this.setPasswordAlert.html(t),this.setPasswordAlert.fadeIn(500)},function(t,e){if(t.cleanData){var a=t.cleanData;t.cleanData=function(e){for(var r,o=0;null!=(r=e[o]);o++)try{t(r).triggerHandler("remove")}catch(i){}a(e)}}else{var r=t.fn.remove;t.fn.remove=function(e,a){return this.each(function(){return a||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),r.call(t(this),e,a)})}}t.widget=function(e,a,r){var o,i=e.split(".")[0];e=e.split(".")[1],o=i+"-"+e,r||(r=a,a=t.Widget),t.expr[":"][o]=function(a){return!!t.data(a,e)},t[i]=t[i]||{},t[i][e]=function(t,e){arguments.length&&this._createWidget(t,e)};var s=new a;s.options=t.extend(!0,{},s.options),t[i][e].prototype=t.extend(!0,s,{namespace:i,widgetName:e,widgetEventPrefix:t[i][e].prototype.widgetEventPrefix||e,widgetBaseClass:o},r),t.widget.bridge(e,t[i][e])},t.widget.bridge=function(a,r){t.fn[a]=function(o){var i="string"==typeof o,s=Array.prototype.slice.call(arguments,1),l=this;return o=!i&&s.length?t.extend.apply(null,[!0,o].concat(s)):o,i&&"_"===o.charAt(0)?l:(i?this.each(function(){var r=t.data(this,a),i=r&&t.isFunction(r[o])?r[o].apply(r,s):r;return i!==r&&i!==e?(l=i,!1):void 0}):this.each(function(){var e=t.data(this,a);e?e.option(o||{})._init():t.data(this,a,new r(o,this))}),l)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,a){t.data(a,this.widgetName,this),this.element=t(a),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(a,r){var o=a;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof a){if(r===e)return this.options[a];o={},o[a]=r}return this._setOptions(o),this},_setOptions:function(e){var a=this;return t.each(e,function(t,e){a._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,a,r){var o,i,s=this.options[e];if(r=r||{},a=t.Event(a),a.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),a.target=this.element[0],i=a.originalEvent,i)for(o in i)o in a||(a[o]=i[o]);return this.element.trigger(a,r),!(t.isFunction(s)&&s.call(this.element[0],a,r)===!1||a.isDefaultPrevented())}}}(jQuery),jQuery.effects||function(t,e){function a(e){var a;return e&&e.constructor==Array&&3==e.length?e:(a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10)]:(a=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(a[1]),2.55*parseFloat(a[2]),2.55*parseFloat(a[3])]:(a=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:(a=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]:(a=/rgba\(0, 0, 0, 0\)/.exec(e))?c.transparent:c[t.trim(e).toLowerCase()]}function r(e,r){var o;do{if(o=(t.curCSS||t.css)(e,r),""!=o&&"transparent"!=o||t.nodeName(e,"body"))break;r="backgroundColor"}while(e=e.parentNode);return a(o)}function o(){var t,e,a=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,r={};if(a&&a.length&&a[0]&&a[a[0]])for(var o=a.length;o--;)t=a[o],"string"==typeof a[t]&&(e=t.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),r[e]=a[t]);else for(t in a)"string"==typeof a[t]&&(r[t]=a[t]);return r}function i(e){var a,r;for(a in e)r=e[a],(null==r||t.isFunction(r)||a in h||/scrollbar/.test(a)||!/color/i.test(a)&&isNaN(parseFloat(r)))&&delete e[a];return e}function s(t,e){var a,r={_:0};for(a in e)t[a]!=e[a]&&(r[a]=e[a]);return r}function l(e,a,r,o){return"object"==typeof e&&(o=a,r=null,a=e,e=a.effect),t.isFunction(a)&&(o=a,r=null,a={}),("number"==typeof a||t.fx.speeds[a])&&(o=r,r=a,a={}),t.isFunction(r)&&(o=r,r=null),a=a||{},r=r||a.duration,r=t.fx.off?0:"number"==typeof r?r:r in t.fx.speeds?t.fx.speeds[r]:t.fx.speeds._default,o=o||a.complete,[e,a,r,o]}function n(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects[e]?!1:!0}t.effects={},t.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(e,o){t.fx.step[o]=function(t){t.colorInit||(t.start=r(t.elem,o),t.end=a(t.end),t.colorInit=!0),t.elem.style[o]="rgb("+Math.max(Math.min(parseInt(t.pos*(t.end[0]-t.start[0])+t.start[0],10),255),0)+","+Math.max(Math.min(parseInt(t.pos*(t.end[1]-t.start[1])+t.start[1],10),255),0)+","+Math.max(Math.min(parseInt(t.pos*(t.end[2]-t.start[2])+t.start[2],10),255),0)+")"}});var c={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},d=["add","remove","toggle"],h={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.effects.animateClass=function(e,a,r,l){return t.isFunction(r)&&(l=r,r=null),this.queue(function(){var n,c=t(this),h=c.attr("style")||" ",u=i(o.call(this)),f=c.attr("class")||"";t.each(d,function(t,a){e[a]&&c[a+"Class"](e[a])}),n=i(o.call(this)),c.attr("class",f),c.animate(s(u,n),{queue:!1,duration:a,easing:r,complete:function(){t.each(d,function(t,a){e[a]&&c[a+"Class"](e[a])}),"object"==typeof c.attr("style")?(c.attr("style").cssText="",c.attr("style").cssText=h):c.attr("style",h),l&&l.apply(this,arguments),t.dequeue(this)}})})},t.fn.extend({_addClass:t.fn.addClass,addClass:function(e,a,r,o){return a?t.effects.animateClass.apply(this,[{add:e},a,r,o]):this._addClass(e)},_removeClass:t.fn.removeClass,removeClass:function(e,a,r,o){return a?t.effects.animateClass.apply(this,[{remove:e},a,r,o]):this._removeClass(e)},_toggleClass:t.fn.toggleClass,toggleClass:function(a,r,o,i,s){return"boolean"==typeof r||r===e?o?t.effects.animateClass.apply(this,[r?{add:a}:{remove:a},o,i,s]):this._toggleClass(a,r):t.effects.animateClass.apply(this,[{toggle:a},r,o,i])},switchClass:function(e,a,r,o,i){return t.effects.animateClass.apply(this,[{add:a,remove:e},r,o,i])}}),t.extend(t.effects,{version:"1.8.23",save:function(t,e){for(var a=0;e.length>a;a++)null!==e[a]&&t.data("ec.storage."+e[a],t[0].style[e[a]])},restore:function(t,e){for(var a=0;e.length>a;a++)null!==e[a]&&t.css(e[a],t.data("ec.storage."+e[a]))},setMode:function(t,e){return"toggle"==e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var a,r;switch(t[0]){case"top":a=0;break;case"middle":a=.5;break;case"bottom":a=1;break;default:a=t[0]/e.height}switch(t[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=t[1]/e.width}return{x:r,y:a}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var a={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},r=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),o=document.activeElement;try{o.id}catch(i){o=document.body}return e.wrap(r),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),r=e.parent(),"static"==e.css("position")?(r.css({position:"relative"}),e.css({position:"relative"})):(t.extend(a,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){a[r]=e.css(r),isNaN(parseInt(a[r],10))&&(a[r]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),r.css(a).show()},removeWrapper:function(e){var a,r=document.activeElement;return e.parent().is(".ui-effects-wrapper")?(a=e.parent().replaceWith(e),(e[0]===r||t.contains(e[0],r))&&t(r).focus(),a):e},setTransition:function(e,a,r,o){return o=o||{},t.each(a,function(t,a){var i=e.cssUnit(a);i[0]>0&&(o[a]=i[0]*r+i[1])}),o}}),t.fn.extend({effect:function(e){var a=l.apply(this,arguments),r={options:a[1],duration:a[2],callback:a[3]},o=r.options.mode,i=t.effects[e];return t.fx.off||!i?o?this[o](r.duration,r.callback):this.each(function(){r.callback&&r.callback.call(this)}):i.call(this,r)},_show:t.fn.show,show:function(t){if(n(t))return this._show.apply(this,arguments);var e=l.apply(this,arguments);return e[1].mode="show",this.effect.apply(this,e)},_hide:t.fn.hide,hide:function(t){if(n(t))return this._hide.apply(this,arguments);var e=l.apply(this,arguments);return e[1].mode="hide",this.effect.apply(this,e)},__toggle:t.fn.toggle,toggle:function(e){if(n(e)||"boolean"==typeof e||t.isFunction(e))return this.__toggle.apply(this,arguments);var a=l.apply(this,arguments);return a[1].mode="toggle",this.effect.apply(this,a)},cssUnit:function(e){var a=this.css(e),r=[];return t.each(["em","px","%","pt"],function(t,e){a.indexOf(e)>0&&(r=[parseFloat(a),e])}),r}});var u={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,e){u[e]=function(e){return Math.pow(e,t+2)}}),t.extend(u,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,a=4;((e=Math.pow(2,--a))-1)/11>t;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(u,function(e,a){t.easing["easeIn"+e]=a,t.easing["easeOut"+e]=function(t){return 1-a(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?a(2*t)/2:a(-2*t+2)/-2+1}})}(jQuery),function(t){"use strict";var e={decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},a="kinetic-settings",r="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),t.support=t.support||{},t.extend(t.support,{touch:"ontouchend"in document});var o=function(){return!1},i=function(t,e){return 0===Math.floor(Math.abs(t))?0:t*e},s=function(t,e){var a=t;return t>0?t>e&&(a=e):0-e>t&&(a=0-e),a},l=function(t,e){this.removeClass(t.movingClass.up).removeClass(t.movingClass.down).removeClass(t.movingClass.left).removeClass(t.movingClass.right).removeClass(t.deceleratingClass.up).removeClass(t.deceleratingClass.down).removeClass(t.deceleratingClass.left).removeClass(t.deceleratingClass.right),t.velocity>0&&this.addClass(e.right),0>t.velocity&&this.addClass(e.left),t.velocityY>0&&this.addClass(e.down),0>t.velocityY&&this.addClass(e.up)},n=function(t,e){"function"==typeof e.stopped&&e.stopped.call(t,e)},c=function(t,e){var a=t[0];e.x&&a.scrollWidth>0?(a.scrollLeft=e.scrollLeft=a.scrollLeft+e.velocity,Math.abs(e.velocity)>0&&(e.velocity=e.decelerate?i(e.velocity,e.slowdown):e.velocity)):e.velocity=0,e.y&&a.scrollHeight>0?(a.scrollTop=e.scrollTop=a.scrollTop+e.velocityY,Math.abs(e.velocityY)>0&&(e.velocityY=e.decelerate?i(e.velocityY,e.slowdown):e.velocityY)):e.velocityY=0,l.call(t,e,e.deceleratingClass),"function"==typeof e.moved&&e.moved.call(t,e),Math.abs(e.velocity)>0||Math.abs(e.velocityY)>0?window.requestAnimationFrame(function(){c(t,e)}):n(t,e)},d=function(e){var r=t.kinetic.callMethods[e],o=Array.prototype.slice.call(arguments);r&&this.each(function(){var e=o.slice(1),i=t(this).data(a);e.unshift(i),r.apply(this,e)})},h=function(e,a){var r=e[0];t.support.touch?(r.addEventListener("touchstart",a.events.touchStart,!1),r.addEventListener("touchend",a.events.inputEnd,!1),r.addEventListener("touchmove",a.events.touchMove,!1)):e.mousedown(a.events.inputDown).mouseup(a.events.inputEnd).mousemove(a.events.inputMove),e.click(a.events.inputClick).bind("selectstart",o),e.bind("dragstart",a.events.dragStart)},u=function(e,a){var r=e[0];t.support.touch?(r.removeEventListener("touchstart",a.events.touchStart,!1),r.removeEventListener("touchend",a.events.inputEnd,!1),r.removeEventListener("touchmove",a.events.touchMove,!1)):e.unbind("mousedown",a.events.inputDown).unbind("mouseup",a.events.inputEnd).unbind("mousemove",a.events.inputMove),e.unbind("click",a.events.inputClick).unbind("selectstart",o),e.unbind("dragstart",a.events.dragStart)},f=function(o){this.addClass(r).each(function(){var r,i,n,d,u=t.extend({},e,o),f=this,p=t(this),m=!1,g=!1,v=!1,S=1e3/u.throttleFPS;u.velocity=0,u.velocityY=0;var b=function(){r=!1,i=!1,v=!1};t(document).mouseup(b).click(b);var w=function(){u.velocity=s(m-r,u.maxvelocity),u.velocityY=s(g-i,u.maxvelocity)},x=function(e){return t.isFunction(u.filterTarget)?u.filterTarget.call(f,e)!==!1:!0},C=function(t,e){v=!0,u.velocity=m=0,u.velocityY=g=0,r=t,i=e},A=function(){r&&m&&u.decelerate===!1&&(u.decelerate=!0,w(),r=m=v=!1,c(p,u))},y=function(e,a){(!n||new Date>new Date(n.getTime()+S))&&(n=new Date,v&&(r||i)&&(d&&(t(d).blur(),d=null,p.focus()),u.decelerate=!1,u.velocity=u.velocityY=0,p[0].scrollLeft=u.scrollLeft=u.x?p[0].scrollLeft-(e-r):p[0].scrollLeft,p[0].scrollTop=u.scrollTop=u.y?p[0].scrollTop-(a-i):p[0].scrollTop,m=r,g=i,r=e,i=a,w(),l.call(p,u,u.movingClass),"function"==typeof u.moved&&u.moved.call(p,u)))};u.events={touchStart:function(t){x(t.target)&&(C(t.touches[0].clientX,t.touches[0].clientY),t.stopPropagation())},touchMove:function(t){v&&(y(t.touches[0].clientX,t.touches[0].clientY),t.preventDefault&&t.preventDefault())},inputDown:function(t){x(t.target)&&(C(t.clientX,t.clientY),d=t.target,"IMG"===t.target.nodeName&&t.preventDefault(),t.stopPropagation())},inputEnd:function(t){A(),d=null,t.preventDefault&&t.preventDefault()},inputMove:function(t){v&&(y(t.clientX,t.clientY),t.preventDefault&&t.preventDefault())},inputClick:function(t){return Math.abs(u.velocity)>0?(t.preventDefault(),!1):void 0},dragStart:function(){return d?!1:void 0}},h(p,u),p.data(a,u).css("cursor","move"),u.triggerHardware&&p.css("-webkit-transform","translate3d(0,0,0)")})};t.kinetic={settingsKey:a,callMethods:{start:function(e,a){var r=t(this);e=t.extend(e,a),e&&(e.decelerate=!1,c(r,e))},end:function(e){t(this),e&&(e.decelerate=!0)},stop:function(t){t.velocity=0,t.velocityY=0,t.decelerate=!0},detach:function(e){var a=t(this);u(a,e),a.removeClass(r).css("cursor","")},attach:function(e){var a=t(this);h(a,e),a.addClass(r).css("cursor","move")}}},t.fn.kinetic=function(t){return"string"==typeof t?d.apply(this,arguments):f.call(this,t),this}}(window.jQuery||window.Zepto),function(t){function e(e){var a=e||window.event,r=[].slice.call(arguments,1),o=0,i=0,s=0;return e=t.event.fix(a),e.type="mousewheel",a.wheelDelta&&(o=a.wheelDelta/120),a.detail&&(o=-a.detail/3),s=o,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(s=0,i=-1*o),void 0!==a.wheelDeltaY&&(s=a.wheelDeltaY/120),void 0!==a.wheelDeltaX&&(i=-1*a.wheelDeltaX/120),r.unshift(e,o,i,s),(t.event.dispatch||t.event.handle).apply(this,r)}var a=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var r=a.length;r;)t.event.fixHooks[a[--r]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=a.length;t;)this.addEventListener(a[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=a.length;t;)this.removeEventListener(a[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery),function(t){t.widget("thomaskahn.smoothDivScroll",{options:{scrollingHotSpotLeftClass:"scrollingHotSpotLeft",scrollingHotSpotRightClass:"scrollingHotSpotRight",scrollableAreaClass:"scrollableArea",scrollWrapperClass:"scrollWrapper",hiddenOnStart:!1,getContentOnLoad:{},countOnlyClass:"",startAtElementId:"",hotSpotScrolling:!0,hotSpotScrollingStep:15,hotSpotScrollingInterval:10,hotSpotMouseDownSpeedBooster:3,visibleHotSpotBackgrounds:"hover",hotSpotsVisibleTime:5e3,easingAfterHotSpotScrolling:!0,easingAfterHotSpotScrollingDistance:10,easingAfterHotSpotScrollingDuration:300,easingAfterHotSpotScrollingFunction:"easeOutQuart",mousewheelScrolling:"",mousewheelScrollingStep:70,easingAfterMouseWheelScrolling:!0,easingAfterMouseWheelScrollingDuration:300,easingAfterMouseWheelScrollingFunction:"easeOutQuart",manualContinuousScrolling:!1,autoScrollingMode:"",autoScrollingDirection:"endlessLoopRight",autoScrollingStep:1,autoScrollingInterval:10,touchScrolling:!1,scrollToAnimationDuration:1e3,scrollToEasingFunction:"easeOutQuart"},_create:function(){var e=this,a=this.options,r=this.element;r.data("scrollWrapper",r.find("."+a.scrollWrapperClass)),r.data("scrollingHotSpotRight",r.find("."+a.scrollingHotSpotRightClass)),r.data("scrollingHotSpotLeft",r.find("."+a.scrollingHotSpotLeftClass)),r.data("scrollableArea",r.find("."+a.scrollableAreaClass)),r.data("scrollingHotSpotRight").length>0&&r.data("scrollingHotSpotRight").detach(),r.data("scrollingHotSpotLeft").length>0&&r.data("scrollingHotSpotLeft").detach(),0===r.data("scrollableArea").length&&0===r.data("scrollWrapper").length?(r.wrapInner("<div class='"+a.scrollableAreaClass+"'>").wrapInner("<div class='"+a.scrollWrapperClass+"'>"),r.data("scrollWrapper",r.find("."+a.scrollWrapperClass)),r.data("scrollableArea",r.find("."+a.scrollableAreaClass))):0===r.data("scrollWrapper").length?(r.wrapInner("<div class='"+a.scrollWrapperClass+"'>"),r.data("scrollWrapper",r.find("."+a.scrollWrapperClass))):0===r.data("scrollableArea").length&&(r.data("scrollWrapper").wrapInner("<div class='"+a.scrollableAreaClass+"'>"),r.data("scrollableArea",r.find("."+a.scrollableAreaClass))),0===r.data("scrollingHotSpotRight").length?(r.prepend("<div class='"+a.scrollingHotSpotRightClass+"'></div>"),r.data("scrollingHotSpotRight",r.find("."+a.scrollingHotSpotRightClass))):r.prepend(r.data("scrollingHotSpotRight")),0===r.data("scrollingHotSpotLeft").length?(r.prepend("<div class='"+a.scrollingHotSpotLeftClass+"'></div>"),r.data("scrollingHotSpotLeft",r.find("."+a.scrollingHotSpotLeftClass))):r.prepend(r.data("scrollingHotSpotLeft")),r.data("speedBooster",1),r.data("scrollXPos",0),r.data("hotSpotWidth",r.data("scrollingHotSpotLeft").innerWidth()),r.data("scrollableAreaWidth",0),r.data("startingPosition",0),r.data("rightScrollingInterval",null),r.data("leftScrollingInterval",null),r.data("autoScrollingInterval",null),r.data("hideHotSpotBackgroundsInterval",null),r.data("previousScrollLeft",0),r.data("pingPongDirection","right"),r.data("getNextElementWidth",!0),r.data("swapAt",null),r.data("startAtElementHasNotPassed",!0),r.data("swappedElement",null),r.data("originalElements",r.data("scrollableArea").children(a.countOnlyClass)),r.data("visible",!0),r.data("enabled",!0),r.data("scrollableAreaHeight",r.data("scrollableArea").height()),r.data("scrollerOffset",r.offset()),a.touchScrolling&&r.data("enabled")&&r.data("scrollWrapper").kinetic({y:!1,moved:function(){a.manualContinuousScrolling&&(0>=r.data("scrollWrapper").scrollLeft()?e._checkContinuousSwapLeft():e._checkContinuousSwapRight())},stopped:function(){r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling()}}),r.data("scrollingHotSpotRight").bind("mousemove",function(t){if(a.hotSpotScrolling){var e=t.pageX-(this.offsetLeft+r.data("scrollerOffset").left);r.data("scrollXPos",Math.round(e/r.data("hotSpotWidth")*a.hotSpotScrollingStep)),(1/0===r.data("scrollXPos")||1>r.data("scrollXPos"))&&r.data("scrollXPos",1)}}),r.data("scrollingHotSpotRight").bind("mouseover",function(){a.hotSpotScrolling&&(r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling(),r.data("rightScrollingInterval",setInterval(function(){r.data("scrollXPos")>0&&r.data("enabled")&&(r.data("scrollWrapper").scrollLeft(r.data("scrollWrapper").scrollLeft()+r.data("scrollXPos")*r.data("speedBooster")),a.manualContinuousScrolling&&e._checkContinuousSwapRight(),e._showHideHotSpots())},a.hotSpotScrollingInterval)),e._trigger("mouseOverRightHotSpot"))}),r.data("scrollingHotSpotRight").bind("mouseout",function(){a.hotSpotScrolling&&(clearInterval(r.data("rightScrollingInterval")),r.data("scrollXPos",0),a.easingAfterHotSpotScrolling&&r.data("enabled")&&r.data("scrollWrapper").animate({scrollLeft:r.data("scrollWrapper").scrollLeft()+a.easingAfterHotSpotScrollingDistance},{duration:a.easingAfterHotSpotScrollingDuration,easing:a.easingAfterHotSpotScrollingFunction}))}),r.data("scrollingHotSpotRight").bind("mousedown",function(){r.data("speedBooster",a.hotSpotMouseDownSpeedBooster)}),t("body").bind("mouseup",function(){r.data("speedBooster",1)}),r.data("scrollingHotSpotLeft").bind("mousemove",function(t){if(a.hotSpotScrolling){var e=this.offsetLeft+r.data("scrollerOffset").left+r.data("hotSpotWidth")-t.pageX;r.data("scrollXPos",Math.round(e/r.data("hotSpotWidth")*a.hotSpotScrollingStep)),(1/0===r.data("scrollXPos")||1>r.data("scrollXPos"))&&r.data("scrollXPos",1)}}),r.data("scrollingHotSpotLeft").bind("mouseover",function(){a.hotSpotScrolling&&(r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling(),r.data("leftScrollingInterval",setInterval(function(){r.data("scrollXPos")>0&&r.data("enabled")&&(r.data("scrollWrapper").scrollLeft(r.data("scrollWrapper").scrollLeft()-r.data("scrollXPos")*r.data("speedBooster")),a.manualContinuousScrolling&&e._checkContinuousSwapLeft(),e._showHideHotSpots())},a.hotSpotScrollingInterval)),e._trigger("mouseOverLeftHotSpot"))}),r.data("scrollingHotSpotLeft").bind("mouseout",function(){a.hotSpotScrolling&&(clearInterval(r.data("leftScrollingInterval")),r.data("scrollXPos",0),a.easingAfterHotSpotScrolling&&r.data("enabled")&&r.data("scrollWrapper").animate({scrollLeft:r.data("scrollWrapper").scrollLeft()-a.easingAfterHotSpotScrollingDistance},{duration:a.easingAfterHotSpotScrollingDuration,easing:a.easingAfterHotSpotScrollingFunction}))}),r.data("scrollingHotSpotLeft").bind("mousedown",function(){r.data("speedBooster",a.hotSpotMouseDownSpeedBooster)}),r.data("scrollableArea").mousewheel(function(t,o,i,s){if(r.data("enabled")&&a.mousewheelScrolling.length>0){var l;"vertical"===a.mousewheelScrolling&&0!==s?(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*s),e.move(l)):"horizontal"===a.mousewheelScrolling&&0!==i?(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*i),e.move(l)):"allDirections"===a.mousewheelScrolling&&(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*o),e.move(l))}}),a.mousewheelScrolling&&r.data("scrollingHotSpotLeft").add(r.data("scrollingHotSpotRight")).mousewheel(function(t){t.preventDefault()}),t(window).bind("resize",function(){e._showHideHotSpots(),e._trigger("windowResized")}),jQuery.isEmptyObject(a.getContentOnLoad)||e[a.getContentOnLoad.method](a.getContentOnLoad.content,a.getContentOnLoad.manipulationMethod,a.getContentOnLoad.addWhere,a.getContentOnLoad.filterTag),a.hiddenOnStart&&e.hide(),t(window).load(function(){if(a.hiddenOnStart||e.recalculateScrollableArea(),a.autoScrollingMode.length>0&&!a.hiddenOnStart&&e.startAutoScrolling(),"always"!==a.autoScrollingMode)switch(a.visibleHotSpotBackgrounds){case"always":e.showHotSpotBackgrounds();break;case"onStart":e.showHotSpotBackgrounds(),r.data("hideHotSpotBackgroundsInterval",setTimeout(function(){e.hideHotSpotBackgrounds(250)},a.hotSpotsVisibleTime));break;case"hover":r.mouseenter(function(t){a.hotSpotScrolling&&(t.stopPropagation(),e.showHotSpotBackgrounds(250))}).mouseleave(function(t){a.hotSpotScrolling&&(t.stopPropagation(),e.hideHotSpotBackgrounds(250))});break;default:}e._showHideHotSpots(),e._trigger("setupComplete")})},_setOption:function(t,e){var a=this,r=this.options,o=this.element;r[t]=e,"hotSpotScrolling"===t?e===!0?a._showHideHotSpots():(o.data("scrollingHotSpotLeft").hide(),o.data("scrollingHotSpotRight").hide()):"autoScrollingStep"===t||"easingAfterHotSpotScrollingDistance"===t||"easingAfterHotSpotScrollingDuration"===t||"easingAfterMouseWheelScrollingDuration"===t?r[t]=parseInt(e,10):"autoScrollingInterval"===t&&(r[t]=parseInt(e,10),a.startAutoScrolling())
},showHotSpotBackgrounds:function(t){var e=this,a=this.element;this.option,void 0!==t?(a.data("scrollingHotSpotLeft").addClass("scrollingHotSpotLeftVisible"),a.data("scrollingHotSpotRight").addClass("scrollingHotSpotRightVisible"),a.data("scrollingHotSpotLeft").add(a.data("scrollingHotSpotRight")).fadeTo(t,.35)):(a.data("scrollingHotSpotLeft").addClass("scrollingHotSpotLeftVisible"),a.data("scrollingHotSpotLeft").removeAttr("style"),a.data("scrollingHotSpotRight").addClass("scrollingHotSpotRightVisible"),a.data("scrollingHotSpotRight").removeAttr("style")),e._showHideHotSpots()},hideHotSpotBackgrounds:function(t){var e=this.element;this.option,void 0!==t?(e.data("scrollingHotSpotLeft").fadeTo(t,0,function(){e.data("scrollingHotSpotLeft").removeClass("scrollingHotSpotLeftVisible")}),e.data("scrollingHotSpotRight").fadeTo(t,0,function(){e.data("scrollingHotSpotRight").removeClass("scrollingHotSpotRightVisible")})):(e.data("scrollingHotSpotLeft").removeClass("scrollingHotSpotLeftVisible").removeAttr("style"),e.data("scrollingHotSpotRight").removeClass("scrollingHotSpotRightVisible").removeAttr("style"))},_showHideHotSpots:function(){var t=this,e=this.element,a=this.options;a.hotSpotScrolling?a.manualContinuousScrolling&&a.hotSpotScrolling&&"always"!==a.autoScrollingMode?(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").show()):"always"!==a.autoScrollingMode&&a.hotSpotScrolling?e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth()?(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide()):0===e.data("scrollWrapper").scrollLeft()?(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").show(),t._trigger("scrollerLeftLimitReached"),clearInterval(e.data("leftScrollingInterval")),e.data("leftScrollingInterval",null)):e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth()+e.data("scrollWrapper").scrollLeft()?(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").hide(),t._trigger("scrollerRightLimitReached"),clearInterval(e.data("rightScrollingInterval")),e.data("rightScrollingInterval",null)):(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").show()):(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide()):(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide())},_setElementScrollPosition:function(e,a){var r=this.element,o=this.options,i=0;switch(e){case"first":return r.data("scrollXPos",0),!0;case"start":return""!==o.startAtElementId&&r.data("scrollableArea").has("#"+o.startAtElementId)?(i=t("#"+o.startAtElementId).position().left,r.data("scrollXPos",i),!0):!1;case"last":return r.data("scrollXPos",r.data("scrollableAreaWidth")-r.data("scrollWrapper").innerWidth()),!0;case"number":return isNaN(a)?!1:(i=r.data("scrollableArea").children(o.countOnlyClass).eq(a-1).position().left,r.data("scrollXPos",i),!0);case"id":return a.length>0&&r.data("scrollableArea").has("#"+a)?(i=t("#"+a).position().left,r.data("scrollXPos",i),!0):!1;default:return!1}},jumpToElement:function(t,e){var a=this,r=this.element;if(r.data("enabled")&&a._setElementScrollPosition(t,e))switch(r.data("scrollWrapper").scrollLeft(r.data("scrollXPos")),a._showHideHotSpots(),t){case"first":a._trigger("jumpedToFirstElement");break;case"start":a._trigger("jumpedToStartElement");break;case"last":a._trigger("jumpedToLastElement");break;case"number":a._trigger("jumpedToElementNumber",null,{elementNumber:e});break;case"id":a._trigger("jumpedToElementId",null,{elementId:e});break;default:}},scrollToElement:function(t,e){var a=this,r=this.element,o=this.options,i=!1;r.data("enabled")&&a._setElementScrollPosition(t,e)&&(null!==r.data("autoScrollingInterval")&&(a.stopAutoScrolling(),i=!0),r.data("scrollWrapper").stop(!0,!1),r.data("scrollWrapper").animate({scrollLeft:r.data("scrollXPos")},{duration:o.scrollToAnimationDuration,easing:o.scrollToEasingFunction,complete:function(){switch(i&&a.startAutoScrolling(),a._showHideHotSpots(),t){case"first":a._trigger("scrolledToFirstElement");break;case"start":a._trigger("scrolledToStartElement");break;case"last":a._trigger("scrolledToLastElement");break;case"number":a._trigger("scrolledToElementNumber",null,{elementNumber:e});break;case"id":a._trigger("scrolledToElementId",null,{elementId:e});break;default:}}}))},move:function(t){var e=this,a=this.element,r=this.options;a.data("scrollWrapper").stop(!0,!0),(0>t&&a.data("scrollWrapper").scrollLeft()>0||t>0&&a.data("scrollableAreaWidth")>a.data("scrollWrapper").innerWidth()+a.data("scrollWrapper").scrollLeft())&&(r.easingAfterMouseWheelScrolling?a.data("scrollWrapper").animate({scrollLeft:a.data("scrollWrapper").scrollLeft()+t},{duration:r.easingAfterMouseWheelScrollingDuration,easing:r.easingAfterMouseWheelFunction,complete:function(){e._showHideHotSpots(),r.manualContinuousScrolling&&(t>0?e._checkContinuousSwapRight():e._checkContinuousSwapLeft())}}):(a.data("scrollWrapper").scrollLeft(a.data("scrollWrapper").scrollLeft()+t),e._showHideHotSpots(),r.manualContinuousScrolling&&(t>0?e._checkContinuousSwapRight():e._checkContinuousSwapLeft())))},getFlickrContent:function(e,a){var r=this,o=this.element;t.getJSON(e,function(e){function i(e,l){var f=e.media.m,p=f.replace("_m",n[l].letter),m=t("<img />").attr("src",p);m.load(function(){if(this.height<o.data("scrollableAreaHeight")?n.length>l+1?i(e,l+1):s(this):s(this),u===h){switch(a){case"addFirst":o.data("scrollableArea").children(":first").before(c);break;case"addLast":o.data("scrollableArea").children(":last").after(c);break;default:o.data("scrollableArea").html(c)}r.recalculateScrollableArea(),r._showHideHotSpots(),r._trigger("addedFlickrContent",null,{addedElementIds:d})}})}function s(e){var a=o.data("scrollableAreaHeight")/e.height,r=Math.round(e.width*a),i=t(e).attr("src").split("/"),s=i.length-1;i=i[s].split("."),t(e).attr("id",i[0]),t(e).css({height:o.data("scrollableAreaHeight"),width:r}),d.push(i[0]),c.push(e),u++}var l,n=[{size:"small square",pixels:75,letter:"_s"},{size:"thumbnail",pixels:100,letter:"_t"},{size:"small",pixels:240,letter:"_m"},{size:"medium",pixels:500,letter:""},{size:"medium 640",pixels:640,letter:"_z"},{size:"large",pixels:1024,letter:"_b"}],c=[],d=[],h=e.items.length,u=0;l=75>=o.data("scrollableAreaHeight")?0:100>=o.data("scrollableAreaHeight")?1:240>=o.data("scrollableAreaHeight")?2:500>=o.data("scrollableAreaHeight")?3:640>=o.data("scrollableAreaHeight")?4:5,t.each(e.items,function(t,e){i(e,l)})})},getAjaxContent:function(e,a,r){var o=this,i=this.element;t.ajaxSetup({cache:!1}),t.get(e,function(s){var l;switch(l=void 0!==r?r.length>0?t("<div>").html(s).find(r):e:s,a){case"addFirst":i.data("scrollableArea").children(":first").before(l);break;case"addLast":i.data("scrollableArea").children(":last").after(l);break;default:i.data("scrollableArea").html(l)}o.recalculateScrollableArea(),o._showHideHotSpots(),o._trigger("addedAjaxContent")})},getHtmlContent:function(e,a,r){var o,i=this,s=this.element;switch(o=void 0!==r?r.length>0?t("<div>").html(e).find(r):e:e,a){case"addFirst":s.data("scrollableArea").children(":first").before(o);break;case"addLast":s.data("scrollableArea").children(":last").after(o);break;default:s.data("scrollableArea").html(o)}i.recalculateScrollableArea(),i._showHideHotSpots(),i._trigger("addedHtmlContent")},recalculateScrollableArea:function(){var e=0,a=!1,r=this.options,o=this.element;o.data("scrollableArea").children(r.countOnlyClass).each(function(){r.startAtElementId.length>0&&t(this).attr("id")===r.startAtElementId&&(o.data("startingPosition",e),a=!0),e+=t(this).outerWidth(!0)}),a||o.data("startAtElementId",""),o.data("scrollableAreaWidth",e),o.data("scrollableArea").width(o.data("scrollableAreaWidth")),o.data("scrollWrapper").scrollLeft(o.data("startingPosition")),o.data("scrollXPos",o.data("startingPosition"))},getScrollerOffset:function(){var t=this.element;return t.data("scrollWrapper").scrollLeft()},stopAutoScrolling:function(){var t=this,e=this.element;null!==e.data("autoScrollingInterval")&&(clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._showHideHotSpots(),t._trigger("autoScrollingStopped"))},startAutoScrolling:function(){var t=this,e=this.element,a=this.options;e.data("enabled")&&(t._showHideHotSpots(),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingStarted"),e.data("autoScrollingInterval",setInterval(function(){if(!e.data("visible")||e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth())clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null);else switch(e.data("previousScrollLeft",e.data("scrollWrapper").scrollLeft()),a.autoScrollingDirection){case"right":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&(t._trigger("autoScrollingRightLimitReached"),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingIntervalStopped"));break;case"left":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&(t._trigger("autoScrollingLeftLimitReached"),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingIntervalStopped"));break;case"backAndForth":"right"===e.data("pingPongDirection")?e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep):e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&("right"===e.data("pingPongDirection")?(e.data("pingPongDirection","left"),t._trigger("autoScrollingRightLimitReached")):(e.data("pingPongDirection","right"),t._trigger("autoScrollingLeftLimitReached")));break;case"endlessLoopRight":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep),t._checkContinuousSwapRight();break;case"endlessLoopLeft":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),t._checkContinuousSwapLeft();break;default:}},a.autoScrollingInterval)))},_checkContinuousSwapRight:function(){var e=this.element,a=this.options;if(e.data("getNextElementWidth")&&(a.startAtElementId.length>0&&e.data("startAtElementHasNotPassed")?(e.data("swapAt",t("#"+a.startAtElementId).outerWidth(!0)),e.data("startAtElementHasNotPassed",!1)):e.data("swapAt",e.data("scrollableArea").children(":first").outerWidth(!0)),e.data("getNextElementWidth",!1)),e.data("swapAt")<=e.data("scrollWrapper").scrollLeft()){e.data("swappedElement",e.data("scrollableArea").children(":first").detach()),e.data("scrollableArea").append(e.data("swappedElement"));var r=e.data("scrollWrapper").scrollLeft();e.data("scrollWrapper").scrollLeft(r-e.data("swappedElement").outerWidth(!0)),e.data("getNextElementWidth",!0)}},_checkContinuousSwapLeft:function(){var e=this.element,a=this.options;e.data("getNextElementWidth")&&(a.startAtElementId.length>0&&e.data("startAtElementHasNotPassed")?(e.data("swapAt",t("#"+a.startAtElementId).outerWidth(!0)),e.data("startAtElementHasNotPassed",!1)):e.data("swapAt",e.data("scrollableArea").children(":first").outerWidth(!0)),e.data("getNextElementWidth",!1)),0===e.data("scrollWrapper").scrollLeft()&&(e.data("swappedElement",e.data("scrollableArea").children(":last").detach()),e.data("scrollableArea").prepend(e.data("swappedElement")),e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+e.data("swappedElement").outerWidth(!0)),e.data("getNextElementWidth",!0))},restoreOriginalElements:function(){var t=this,e=this.element;e.data("scrollableArea").html(e.data("originalElements")),t.recalculateScrollableArea(),t.jumpToElement("first")},show:function(){var t=this.element;t.data("visible",!0),t.show()},hide:function(){var t=this.element;t.data("visible",!1),t.hide()},enable:function(){var t=this.element;this.options.touchScrolling&&t.data("scrollWrapper").kinetic("attach"),t.data("enabled",!0)},disable:function(){var t=this,e=this.element;t.stopAutoScrolling(),clearInterval(e.data("rightScrollingInterval")),clearInterval(e.data("leftScrollingInterval")),clearInterval(e.data("hideHotSpotBackgroundsInterval")),this.options.touchScrolling&&e.data("scrollWrapper").kinetic("detach"),e.data("enabled",!1)},destroy:function(){var e=this,a=this.element;e.stopAutoScrolling(),clearInterval(a.data("rightScrollingInterval")),clearInterval(a.data("leftScrollingInterval")),clearInterval(a.data("hideHotSpotBackgroundsInterval")),a.data("scrollingHotSpotRight").unbind("mouseover"),a.data("scrollingHotSpotRight").unbind("mouseout"),a.data("scrollingHotSpotRight").unbind("mousedown"),a.data("scrollingHotSpotLeft").unbind("mouseover"),a.data("scrollingHotSpotLeft").unbind("mouseout"),a.data("scrollingHotSpotLeft").unbind("mousedown"),a.unbind("mousenter"),a.unbind("mouseleave"),a.data("scrollingHotSpotRight").remove(),a.data("scrollingHotSpotLeft").remove(),a.data("scrollableArea").remove(),a.data("scrollWrapper").remove(),a.html(a.data("originalElements")),t.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery),function(t){t.widget("thomaskahn.smoothDivScroll",{options:{scrollingHotSpotLeftClass:"scrollingHotSpotLeft",scrollingHotSpotRightClass:"scrollingHotSpotRight",scrollableAreaClass:"scrollableArea",scrollWrapperClass:"scrollWrapper",hiddenOnStart:!1,getContentOnLoad:{},countOnlyClass:"",startAtElementId:"",hotSpotScrolling:!0,hotSpotScrollingStep:15,hotSpotScrollingInterval:10,hotSpotMouseDownSpeedBooster:3,visibleHotSpotBackgrounds:"hover",hotSpotsVisibleTime:5e3,easingAfterHotSpotScrolling:!0,easingAfterHotSpotScrollingDistance:10,easingAfterHotSpotScrollingDuration:300,easingAfterHotSpotScrollingFunction:"easeOutQuart",mousewheelScrolling:"",mousewheelScrollingStep:70,easingAfterMouseWheelScrolling:!0,easingAfterMouseWheelScrollingDuration:300,easingAfterMouseWheelScrollingFunction:"easeOutQuart",manualContinuousScrolling:!1,autoScrollingMode:"",autoScrollingDirection:"endlessLoopRight",autoScrollingStep:1,autoScrollingInterval:10,touchScrolling:!1,scrollToAnimationDuration:1e3,scrollToEasingFunction:"easeOutQuart"},_create:function(){var e=this,a=this.options,r=this.element;r.data("scrollWrapper",r.find("."+a.scrollWrapperClass)),r.data("scrollingHotSpotRight",r.find("."+a.scrollingHotSpotRightClass)),r.data("scrollingHotSpotLeft",r.find("."+a.scrollingHotSpotLeftClass)),r.data("scrollableArea",r.find("."+a.scrollableAreaClass)),r.data("scrollingHotSpotRight").length>0&&r.data("scrollingHotSpotRight").detach(),r.data("scrollingHotSpotLeft").length>0&&r.data("scrollingHotSpotLeft").detach(),0===r.data("scrollableArea").length&&0===r.data("scrollWrapper").length?(r.wrapInner("<div class='"+a.scrollableAreaClass+"'>").wrapInner("<div class='"+a.scrollWrapperClass+"'>"),r.data("scrollWrapper",r.find("."+a.scrollWrapperClass)),r.data("scrollableArea",r.find("."+a.scrollableAreaClass))):0===r.data("scrollWrapper").length?(r.wrapInner("<div class='"+a.scrollWrapperClass+"'>"),r.data("scrollWrapper",r.find("."+a.scrollWrapperClass))):0===r.data("scrollableArea").length&&(r.data("scrollWrapper").wrapInner("<div class='"+a.scrollableAreaClass+"'>"),r.data("scrollableArea",r.find("."+a.scrollableAreaClass))),0===r.data("scrollingHotSpotRight").length?(r.prepend("<div class='"+a.scrollingHotSpotRightClass+"'></div>"),r.data("scrollingHotSpotRight",r.find("."+a.scrollingHotSpotRightClass))):r.prepend(r.data("scrollingHotSpotRight")),0===r.data("scrollingHotSpotLeft").length?(r.prepend("<div class='"+a.scrollingHotSpotLeftClass+"'></div>"),r.data("scrollingHotSpotLeft",r.find("."+a.scrollingHotSpotLeftClass))):r.prepend(r.data("scrollingHotSpotLeft")),r.data("speedBooster",1),r.data("scrollXPos",0),r.data("hotSpotWidth",r.data("scrollingHotSpotLeft").innerWidth()),r.data("scrollableAreaWidth",0),r.data("startingPosition",0),r.data("rightScrollingInterval",null),r.data("leftScrollingInterval",null),r.data("autoScrollingInterval",null),r.data("hideHotSpotBackgroundsInterval",null),r.data("previousScrollLeft",0),r.data("pingPongDirection","right"),r.data("getNextElementWidth",!0),r.data("swapAt",null),r.data("startAtElementHasNotPassed",!0),r.data("swappedElement",null),r.data("originalElements",r.data("scrollableArea").children(a.countOnlyClass)),r.data("visible",!0),r.data("enabled",!0),r.data("scrollableAreaHeight",r.data("scrollableArea").height()),r.data("scrollerOffset",r.offset()),a.touchScrolling&&r.data("enabled")&&r.data("scrollWrapper").kinetic({y:!1,moved:function(){a.manualContinuousScrolling&&(0>=r.data("scrollWrapper").scrollLeft()?e._checkContinuousSwapLeft():e._checkContinuousSwapRight())},stopped:function(){r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling()}}),r.data("scrollingHotSpotRight").bind("mousemove",function(t){if(a.hotSpotScrolling){var e=t.pageX-(this.offsetLeft+r.data("scrollerOffset").left);r.data("scrollXPos",Math.round(e/r.data("hotSpotWidth")*a.hotSpotScrollingStep)),(1/0===r.data("scrollXPos")||1>r.data("scrollXPos"))&&r.data("scrollXPos",1)}}),r.data("scrollingHotSpotRight").bind("mouseover",function(){a.hotSpotScrolling&&(r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling(),r.data("rightScrollingInterval",setInterval(function(){r.data("scrollXPos")>0&&r.data("enabled")&&(r.data("scrollWrapper").scrollLeft(r.data("scrollWrapper").scrollLeft()+r.data("scrollXPos")*r.data("speedBooster")),a.manualContinuousScrolling&&e._checkContinuousSwapRight(),e._showHideHotSpots())},a.hotSpotScrollingInterval)),e._trigger("mouseOverRightHotSpot"))}),r.data("scrollingHotSpotRight").bind("mouseout",function(){a.hotSpotScrolling&&(clearInterval(r.data("rightScrollingInterval")),r.data("scrollXPos",0),a.easingAfterHotSpotScrolling&&r.data("enabled")&&r.data("scrollWrapper").animate({scrollLeft:r.data("scrollWrapper").scrollLeft()+a.easingAfterHotSpotScrollingDistance},{duration:a.easingAfterHotSpotScrollingDuration,easing:a.easingAfterHotSpotScrollingFunction}))}),r.data("scrollingHotSpotRight").bind("mousedown",function(){r.data("speedBooster",a.hotSpotMouseDownSpeedBooster)}),t("body").bind("mouseup",function(){r.data("speedBooster",1)}),r.data("scrollingHotSpotLeft").bind("mousemove",function(t){if(a.hotSpotScrolling){var e=this.offsetLeft+r.data("scrollerOffset").left+r.data("hotSpotWidth")-t.pageX;r.data("scrollXPos",Math.round(e/r.data("hotSpotWidth")*a.hotSpotScrollingStep)),(1/0===r.data("scrollXPos")||1>r.data("scrollXPos"))&&r.data("scrollXPos",1)}}),r.data("scrollingHotSpotLeft").bind("mouseover",function(){a.hotSpotScrolling&&(r.data("scrollWrapper").stop(!0,!1),e.stopAutoScrolling(),r.data("leftScrollingInterval",setInterval(function(){r.data("scrollXPos")>0&&r.data("enabled")&&(r.data("scrollWrapper").scrollLeft(r.data("scrollWrapper").scrollLeft()-r.data("scrollXPos")*r.data("speedBooster")),a.manualContinuousScrolling&&e._checkContinuousSwapLeft(),e._showHideHotSpots())},a.hotSpotScrollingInterval)),e._trigger("mouseOverLeftHotSpot"))}),r.data("scrollingHotSpotLeft").bind("mouseout",function(){a.hotSpotScrolling&&(clearInterval(r.data("leftScrollingInterval")),r.data("scrollXPos",0),a.easingAfterHotSpotScrolling&&r.data("enabled")&&r.data("scrollWrapper").animate({scrollLeft:r.data("scrollWrapper").scrollLeft()-a.easingAfterHotSpotScrollingDistance},{duration:a.easingAfterHotSpotScrollingDuration,easing:a.easingAfterHotSpotScrollingFunction}))}),r.data("scrollingHotSpotLeft").bind("mousedown",function(){r.data("speedBooster",a.hotSpotMouseDownSpeedBooster)}),r.data("scrollableArea").mousewheel(function(t,o,i,s){if(r.data("enabled")&&a.mousewheelScrolling.length>0){var l;"vertical"===a.mousewheelScrolling&&0!==s?(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*s),e.move(l)):"horizontal"===a.mousewheelScrolling&&0!==i?(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*i),e.move(l)):"allDirections"===a.mousewheelScrolling&&(e.stopAutoScrolling(),t.preventDefault(),l=Math.round(-1*a.mousewheelScrollingStep*o),e.move(l))}}),a.mousewheelScrolling&&r.data("scrollingHotSpotLeft").add(r.data("scrollingHotSpotRight")).mousewheel(function(t){t.preventDefault()}),t(window).bind("resize",function(){e._showHideHotSpots(),e._trigger("windowResized")}),jQuery.isEmptyObject(a.getContentOnLoad)||e[a.getContentOnLoad.method](a.getContentOnLoad.content,a.getContentOnLoad.manipulationMethod,a.getContentOnLoad.addWhere,a.getContentOnLoad.filterTag),a.hiddenOnStart&&e.hide(),t(window).load(function(){if(a.hiddenOnStart||e.recalculateScrollableArea(),a.autoScrollingMode.length>0&&!a.hiddenOnStart&&e.startAutoScrolling(),"always"!==a.autoScrollingMode)switch(a.visibleHotSpotBackgrounds){case"always":e.showHotSpotBackgrounds();break;case"onStart":e.showHotSpotBackgrounds(),r.data("hideHotSpotBackgroundsInterval",setTimeout(function(){e.hideHotSpotBackgrounds(250)},a.hotSpotsVisibleTime));break;case"hover":r.mouseenter(function(t){a.hotSpotScrolling&&(t.stopPropagation(),e.showHotSpotBackgrounds(250))}).mouseleave(function(t){a.hotSpotScrolling&&(t.stopPropagation(),e.hideHotSpotBackgrounds(250))});break;default:}e._showHideHotSpots(),e._trigger("setupComplete")})},_setOption:function(t,e){var a=this,r=this.options,o=this.element;r[t]=e,"hotSpotScrolling"===t?e===!0?a._showHideHotSpots():(o.data("scrollingHotSpotLeft").hide(),o.data("scrollingHotSpotRight").hide()):"autoScrollingStep"===t||"easingAfterHotSpotScrollingDistance"===t||"easingAfterHotSpotScrollingDuration"===t||"easingAfterMouseWheelScrollingDuration"===t?r[t]=parseInt(e,10):"autoScrollingInterval"===t&&(r[t]=parseInt(e,10),a.startAutoScrolling())},showHotSpotBackgrounds:function(t){var e=this,a=this.element;this.option,void 0!==t?(a.data("scrollingHotSpotLeft").addClass("scrollingHotSpotLeftVisible"),a.data("scrollingHotSpotRight").addClass("scrollingHotSpotRightVisible"),a.data("scrollingHotSpotLeft").add(a.data("scrollingHotSpotRight")).fadeTo(t,.35)):(a.data("scrollingHotSpotLeft").addClass("scrollingHotSpotLeftVisible"),a.data("scrollingHotSpotLeft").removeAttr("style"),a.data("scrollingHotSpotRight").addClass("scrollingHotSpotRightVisible"),a.data("scrollingHotSpotRight").removeAttr("style")),e._showHideHotSpots()},hideHotSpotBackgrounds:function(t){var e=this.element;this.option,void 0!==t?(e.data("scrollingHotSpotLeft").fadeTo(t,0,function(){e.data("scrollingHotSpotLeft").removeClass("scrollingHotSpotLeftVisible")}),e.data("scrollingHotSpotRight").fadeTo(t,0,function(){e.data("scrollingHotSpotRight").removeClass("scrollingHotSpotRightVisible")})):(e.data("scrollingHotSpotLeft").removeClass("scrollingHotSpotLeftVisible").removeAttr("style"),e.data("scrollingHotSpotRight").removeClass("scrollingHotSpotRightVisible").removeAttr("style"))},_showHideHotSpots:function(){var t=this,e=this.element,a=this.options;a.hotSpotScrolling?a.manualContinuousScrolling&&a.hotSpotScrolling&&"always"!==a.autoScrollingMode?(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").show()):"always"!==a.autoScrollingMode&&a.hotSpotScrolling?e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth()?(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide()):0===e.data("scrollWrapper").scrollLeft()?(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").show(),t._trigger("scrollerLeftLimitReached"),clearInterval(e.data("leftScrollingInterval")),e.data("leftScrollingInterval",null)):e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth()+e.data("scrollWrapper").scrollLeft()?(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").hide(),t._trigger("scrollerRightLimitReached"),clearInterval(e.data("rightScrollingInterval")),e.data("rightScrollingInterval",null)):(e.data("scrollingHotSpotLeft").show(),e.data("scrollingHotSpotRight").show()):(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide()):(e.data("scrollingHotSpotLeft").hide(),e.data("scrollingHotSpotRight").hide())},_setElementScrollPosition:function(e,a){var r=this.element,o=this.options,i=0;switch(e){case"first":return r.data("scrollXPos",0),!0;case"start":return""!==o.startAtElementId&&r.data("scrollableArea").has("#"+o.startAtElementId)?(i=t("#"+o.startAtElementId).position().left,r.data("scrollXPos",i),!0):!1;case"last":return r.data("scrollXPos",r.data("scrollableAreaWidth")-r.data("scrollWrapper").innerWidth()),!0;case"number":return isNaN(a)?!1:(i=r.data("scrollableArea").children(o.countOnlyClass).eq(a-1).position().left,r.data("scrollXPos",i),!0);case"id":return a.length>0&&r.data("scrollableArea").has("#"+a)?(i=t("#"+a).position().left,r.data("scrollXPos",i),!0):!1;default:return!1}},jumpToElement:function(t,e){var a=this,r=this.element;if(r.data("enabled")&&a._setElementScrollPosition(t,e))switch(r.data("scrollWrapper").scrollLeft(r.data("scrollXPos")),a._showHideHotSpots(),t){case"first":a._trigger("jumpedToFirstElement");break;case"start":a._trigger("jumpedToStartElement");break;case"last":a._trigger("jumpedToLastElement");break;case"number":a._trigger("jumpedToElementNumber",null,{elementNumber:e});break;case"id":a._trigger("jumpedToElementId",null,{elementId:e});break;default:}},scrollToElement:function(t,e){var a=this,r=this.element,o=this.options,i=!1;r.data("enabled")&&a._setElementScrollPosition(t,e)&&(null!==r.data("autoScrollingInterval")&&(a.stopAutoScrolling(),i=!0),r.data("scrollWrapper").stop(!0,!1),r.data("scrollWrapper").animate({scrollLeft:r.data("scrollXPos")},{duration:o.scrollToAnimationDuration,easing:o.scrollToEasingFunction,complete:function(){switch(i&&a.startAutoScrolling(),a._showHideHotSpots(),t){case"first":a._trigger("scrolledToFirstElement");break;case"start":a._trigger("scrolledToStartElement");break;case"last":a._trigger("scrolledToLastElement");break;case"number":a._trigger("scrolledToElementNumber",null,{elementNumber:e});break;case"id":a._trigger("scrolledToElementId",null,{elementId:e});break;default:}}}))},move:function(t){var e=this,a=this.element,r=this.options;a.data("scrollWrapper").stop(!0,!0),(0>t&&a.data("scrollWrapper").scrollLeft()>0||t>0&&a.data("scrollableAreaWidth")>a.data("scrollWrapper").innerWidth()+a.data("scrollWrapper").scrollLeft())&&(r.easingAfterMouseWheelScrolling?a.data("scrollWrapper").animate({scrollLeft:a.data("scrollWrapper").scrollLeft()+t},{duration:r.easingAfterMouseWheelScrollingDuration,easing:r.easingAfterMouseWheelFunction,complete:function(){e._showHideHotSpots(),r.manualContinuousScrolling&&(t>0?e._checkContinuousSwapRight():e._checkContinuousSwapLeft())}}):(a.data("scrollWrapper").scrollLeft(a.data("scrollWrapper").scrollLeft()+t),e._showHideHotSpots(),r.manualContinuousScrolling&&(t>0?e._checkContinuousSwapRight():e._checkContinuousSwapLeft())))},getFlickrContent:function(e,a){var r=this,o=this.element;t.getJSON(e,function(e){function i(e,l){var f=e.media.m,p=f.replace("_m",n[l].letter),m=t("<img />").attr("src",p);m.load(function(){if(this.height<o.data("scrollableAreaHeight")?n.length>l+1?i(e,l+1):s(this):s(this),u===h){switch(a){case"addFirst":o.data("scrollableArea").children(":first").before(c);break;case"addLast":o.data("scrollableArea").children(":last").after(c);break;default:o.data("scrollableArea").html(c)}r.recalculateScrollableArea(),r._showHideHotSpots(),r._trigger("addedFlickrContent",null,{addedElementIds:d})}})}function s(e){var a=o.data("scrollableAreaHeight")/e.height,r=Math.round(e.width*a),i=t(e).attr("src").split("/"),s=i.length-1;i=i[s].split("."),t(e).attr("id",i[0]),t(e).css({height:o.data("scrollableAreaHeight"),width:r}),d.push(i[0]),c.push(e),u++}var l,n=[{size:"small square",pixels:75,letter:"_s"},{size:"thumbnail",pixels:100,letter:"_t"},{size:"small",pixels:240,letter:"_m"},{size:"medium",pixels:500,letter:""},{size:"medium 640",pixels:640,letter:"_z"},{size:"large",pixels:1024,letter:"_b"}],c=[],d=[],h=e.items.length,u=0;l=75>=o.data("scrollableAreaHeight")?0:100>=o.data("scrollableAreaHeight")?1:240>=o.data("scrollableAreaHeight")?2:500>=o.data("scrollableAreaHeight")?3:640>=o.data("scrollableAreaHeight")?4:5,t.each(e.items,function(t,e){i(e,l)})})},getAjaxContent:function(e,a,r){var o=this,i=this.element;t.ajaxSetup({cache:!1}),t.get(e,function(s){var l;switch(l=void 0!==r?r.length>0?t("<div>").html(s).find(r):e:s,a){case"addFirst":i.data("scrollableArea").children(":first").before(l);break;case"addLast":i.data("scrollableArea").children(":last").after(l);break;default:i.data("scrollableArea").html(l)}o.recalculateScrollableArea(),o._showHideHotSpots(),o._trigger("addedAjaxContent")})},getHtmlContent:function(e,a,r){var o,i=this,s=this.element;switch(o=void 0!==r?r.length>0?t("<div>").html(e).find(r):e:e,a){case"addFirst":s.data("scrollableArea").children(":first").before(o);break;case"addLast":s.data("scrollableArea").children(":last").after(o);break;default:s.data("scrollableArea").html(o)}i.recalculateScrollableArea(),i._showHideHotSpots(),i._trigger("addedHtmlContent")},recalculateScrollableArea:function(){var e=0,a=!1,r=this.options,o=this.element;o.data("scrollableArea").children(r.countOnlyClass).each(function(){r.startAtElementId.length>0&&t(this).attr("id")===r.startAtElementId&&(o.data("startingPosition",e),a=!0),e+=t(this).outerWidth(!0)}),a||o.data("startAtElementId",""),o.data("scrollableAreaWidth",e),o.data("scrollableArea").width(o.data("scrollableAreaWidth")),o.data("scrollWrapper").scrollLeft(o.data("startingPosition")),o.data("scrollXPos",o.data("startingPosition"))},getScrollerOffset:function(){var t=this.element;return t.data("scrollWrapper").scrollLeft()},stopAutoScrolling:function(){var t=this,e=this.element;null!==e.data("autoScrollingInterval")&&(clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._showHideHotSpots(),t._trigger("autoScrollingStopped"))},startAutoScrolling:function(){var t=this,e=this.element,a=this.options;e.data("enabled")&&(t._showHideHotSpots(),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingStarted"),e.data("autoScrollingInterval",setInterval(function(){if(!e.data("visible")||e.data("scrollableAreaWidth")<=e.data("scrollWrapper").innerWidth())clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null);else switch(e.data("previousScrollLeft",e.data("scrollWrapper").scrollLeft()),a.autoScrollingDirection){case"right":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&(t._trigger("autoScrollingRightLimitReached"),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingIntervalStopped"));break;case"left":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&(t._trigger("autoScrollingLeftLimitReached"),clearInterval(e.data("autoScrollingInterval")),e.data("autoScrollingInterval",null),t._trigger("autoScrollingIntervalStopped"));break;case"backAndForth":"right"===e.data("pingPongDirection")?e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep):e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),e.data("previousScrollLeft")===e.data("scrollWrapper").scrollLeft()&&("right"===e.data("pingPongDirection")?(e.data("pingPongDirection","left"),t._trigger("autoScrollingRightLimitReached")):(e.data("pingPongDirection","right"),t._trigger("autoScrollingLeftLimitReached")));break;case"endlessLoopRight":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+a.autoScrollingStep),t._checkContinuousSwapRight();break;case"endlessLoopLeft":e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()-a.autoScrollingStep),t._checkContinuousSwapLeft();
break;default:}},a.autoScrollingInterval)))},_checkContinuousSwapRight:function(){var e=this.element,a=this.options;if(e.data("getNextElementWidth")&&(a.startAtElementId.length>0&&e.data("startAtElementHasNotPassed")?(e.data("swapAt",t("#"+a.startAtElementId).outerWidth(!0)),e.data("startAtElementHasNotPassed",!1)):e.data("swapAt",e.data("scrollableArea").children(":first").outerWidth(!0)),e.data("getNextElementWidth",!1)),e.data("swapAt")<=e.data("scrollWrapper").scrollLeft()){e.data("swappedElement",e.data("scrollableArea").children(":first").detach()),e.data("scrollableArea").append(e.data("swappedElement"));var r=e.data("scrollWrapper").scrollLeft();e.data("scrollWrapper").scrollLeft(r-e.data("swappedElement").outerWidth(!0)),e.data("getNextElementWidth",!0)}},_checkContinuousSwapLeft:function(){var e=this.element,a=this.options;e.data("getNextElementWidth")&&(a.startAtElementId.length>0&&e.data("startAtElementHasNotPassed")?(e.data("swapAt",t("#"+a.startAtElementId).outerWidth(!0)),e.data("startAtElementHasNotPassed",!1)):e.data("swapAt",e.data("scrollableArea").children(":first").outerWidth(!0)),e.data("getNextElementWidth",!1)),0===e.data("scrollWrapper").scrollLeft()&&(e.data("swappedElement",e.data("scrollableArea").children(":last").detach()),e.data("scrollableArea").prepend(e.data("swappedElement")),e.data("scrollWrapper").scrollLeft(e.data("scrollWrapper").scrollLeft()+e.data("swappedElement").outerWidth(!0)),e.data("getNextElementWidth",!0))},restoreOriginalElements:function(){var t=this,e=this.element;e.data("scrollableArea").html(e.data("originalElements")),t.recalculateScrollableArea(),t.jumpToElement("first")},show:function(){var t=this.element;t.data("visible",!0),t.show()},hide:function(){var t=this.element;t.data("visible",!1),t.hide()},enable:function(){var t=this.element;this.options.touchScrolling&&t.data("scrollWrapper").kinetic("attach"),t.data("enabled",!0)},disable:function(){var t=this,e=this.element;t.stopAutoScrolling(),clearInterval(e.data("rightScrollingInterval")),clearInterval(e.data("leftScrollingInterval")),clearInterval(e.data("hideHotSpotBackgroundsInterval")),this.options.touchScrolling&&e.data("scrollWrapper").kinetic("detach"),e.data("enabled",!1)},destroy:function(){var e=this,a=this.element;e.stopAutoScrolling(),clearInterval(a.data("rightScrollingInterval")),clearInterval(a.data("leftScrollingInterval")),clearInterval(a.data("hideHotSpotBackgroundsInterval")),a.data("scrollingHotSpotRight").unbind("mouseover"),a.data("scrollingHotSpotRight").unbind("mouseout"),a.data("scrollingHotSpotRight").unbind("mousedown"),a.data("scrollingHotSpotLeft").unbind("mouseover"),a.data("scrollingHotSpotLeft").unbind("mouseout"),a.data("scrollingHotSpotLeft").unbind("mousedown"),a.unbind("mousenter"),a.unbind("mouseleave"),a.data("scrollingHotSpotRight").remove(),a.data("scrollingHotSpotLeft").remove(),a.data("scrollableArea").remove(),a.data("scrollWrapper").remove(),a.html(a.data("originalElements")),t.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery);var a,JSC3D=JSC3D||{};JSC3D.Viewer=function(t,e){this.params=e?{SceneUrl:e.SceneUrl||"",InitRotationX:e.InitRotationX||0,InitRotationY:e.InitRotationY||0,InitRotationZ:e.InitRotationZ||0,ModelColor:e.ModelColor||"#caa618",BackgroundColor1:e.BackgroundColor1||"#ffffff",BackgroundColor2:e.BackgroundColor2||"#383840",BackgroundImageUrl:e.BackgroundImageUrl||"",RenderMode:e.RenderMode||"flat",Definition:e.Definition||"standard",MipMapping:e.MipMapping||"off",CreaseAngle:e.parameters||-180,SphereMapUrl:e.SphereMapUrl||""}:{SceneUrl:"",InitRotationX:0,InitRotationY:0,InitRotationZ:0,ModelColor:"#caa618",BackgroundColor1:"#ffffff",BackgroundColor2:"#383840",BackgroundImageUrl:"",RenderMode:"flat",Definition:"standard",MipMapping:"off",CreaseAngle:-180,SphereMapUrl:""},this.canvas=t,this.selectionBuffer=this.zBuffer=this.colorBuffer=this.bkgColorBuffer=this.canvasData=this.ctx=null,this.frameWidth=t.width,this.frameHeight=t.height,this.sphereMap=this.defaultMaterial=this.scene=null,this.isFailed=this.isLoaded=!1,this.errorMsg="",this.needRepaint=this.needUpdate=!1,this.initRotZ=this.initRotY=this.initRotX=0,this.zoomFactor=1,this.panning=[0,0],this.rotMatrix=new JSC3D.Matrix3x4,this.transformMatrix=new JSC3D.Matrix3x4,this.sceneUrl="",this.modelColor=13280792,this.bkgColor1=16777215,this.bkgColor2=3684416,this.bkgImageUrl="",this.bkgImage=null,this.renderMode="flat",this.definition="standard",this.isMipMappingOn=!1,this.creaseAngle=-180,this.sphereMapUrl="",this.buttonStates={},this.keyStates={},this.mouseY=this.mouseX=0,this.afterupdate=this.beforeupdate=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=null,this.mouseUsage="default",this.isDefaultInputHandlerEnabled=!0;var a=this;JSC3D.PlatformInfo.isTouchDevice?(this.canvas.addEventListener("touchstart",function(t){a.touchStartHandler(t)},!1),this.canvas.addEventListener("touchend",function(t){a.touchEndHandler(t)},!1),this.canvas.addEventListener("touchmove",function(t){a.touchMoveHandler(t)},!1)):(this.canvas.addEventListener("mousedown",function(t){a.mouseDownHandler(t)},!1),this.canvas.addEventListener("mouseup",function(t){a.mouseUpHandler(t)},!1),this.canvas.addEventListener("mousemove",function(t){a.mouseMoveHandler(t)},!1),this.canvas.addEventListener("firefox"==JSC3D.PlatformInfo.browser?"DOMMouseScroll":"mousewheel",function(t){a.mouseWheelHandler(t)},!1),document.addEventListener("keydown",function(t){a.keyDownHandler(t)},!1),document.addEventListener("keyup",function(t){a.keyUpHandler(t)},!1))},a=JSC3D.Viewer.prototype,a.setParameter=function(t,e){this.params[t]=e},a.init=function(){this.sceneUrl=this.params.SceneUrl,this.initRotX=parseFloat(this.params.InitRotationX),this.initRotY=parseFloat(this.params.InitRotationY),this.initRotZ=parseFloat(this.params.InitRotationZ),this.modelColor=parseInt("0x"+this.params.ModelColor.substring(1)),this.bkgColor1=parseInt("0x"+this.params.BackgroundColor1.substring(1)),this.bkgColor2=parseInt("0x"+this.params.BackgroundColor2.substring(1)),this.bkgImageUrl=this.params.BackgroundImageUrl,this.renderMode=this.params.RenderMode.toLowerCase(),this.definition=this.params.Definition.toLowerCase(),this.creaseAngle=parseFloat(this.params.CreaseAngle),this.isMipMappingOn="on"==this.params.MipMapping.toLowerCase(),this.sphereMapUrl=this.params.SphereMapUrl;try{this.ctx=this.canvas.getContext("2d"),this.canvasData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}catch(t){this.canvasData=this.ctx=null}switch((2>=this.canvas.width||2>=this.canvas.height)&&(this.definition="standard"),this.definition){case"low":this.frameWidth=~~((this.canvas.width+1)/2),this.frameHeight=~~((this.canvas.height+1)/2);break;case"high":this.frameWidth=2*this.canvas.width,this.frameHeight=2*this.canvas.height;break;case"standard":default:this.frameWidth=this.canvas.width,this.frameHeight=this.canvas.height}this.zoomFactor=1,this.panning=[0,0],this.rotMatrix.identity(),this.transformMatrix.identity(),this.isFailed=this.isLoaded=!1,this.errorMsg="",this.needRepaint=this.needUpdate=!1,this.scene=null,this.colorBuffer=Array(this.frameWidth*this.frameHeight),this.zBuffer=Array(this.frameWidth*this.frameHeight),this.selectionBuffer=Array(this.frameWidth*this.frameHeight),this.bkgColorBuffer=Array(this.frameWidth*this.frameHeight),this.generateBackground(),this.defaultMaterial=new JSC3D.Material,this.defaultMaterial.ambientColor=0,this.defaultMaterial.diffuseColor=this.modelColor,this.defaultMaterial.transparency=0,this.defaultMaterial.simulateSpecular=!0,this.drawBackground();var e=this;(function a(){e.doUpdate(),setTimeout(a,30)})(),this.setBackgroudImageFromUrl(this.bkgImageUrl),this.loadScene(),this.setSphereMapFromUrl(this.sphereMapUrl)},a.update=function(t){this.isFailed?this.reportError(this.errorMsg):t?this.needRepaint=!0:this.needUpdate=!0},a.rotate=function(t,e,a){this.rotMatrix.rotateAboutXAxis(t),this.rotMatrix.rotateAboutYAxis(e),this.rotMatrix.rotateAboutZAxis(a)},a.setRenderMode=function(t){this.renderMode=this.params.RenderMode=t},a.setDefinition=function(t){if((2>=this.canvas.width||2>=this.canvas.height)&&(t="standard"),t!=this.definition){switch(this.definition=this.params.Definition=t,t=this.frameWidth,this.definition){case"low":this.frameWidth=~~((this.canvas.width+1)/2),this.frameHeight=~~((this.canvas.height+1)/2);break;case"high":this.frameWidth=2*this.canvas.width,this.frameHeight=2*this.canvas.height;break;case"standard":default:this.frameWidth=this.canvas.width,this.frameHeight=this.canvas.height}var e=this.frameWidth*this.frameHeight;e>this.colorBuffer.length&&(this.colorBuffer=Array(e)),e>this.zBuffer.length&&(this.zBuffer=Array(e)),e>this.selectionBuffer.length&&(this.selectionBuffer=Array(e)),e>this.bkgColorBuffer.length&&(this.bkgColorBuffer=Array(e)),this.generateBackground(),t=this.frameWidth/t,this.zoomFactor*=t,this.panning[0]*=t,this.panning[1]*=t}},a.setBackgroudImageFromUrl=function(t){if(this.bkgImageUrl=this.params.BackgroundImageUrl=t,""==t)this.bkgImage=null;else{var e=this,a=new Image;a.onload=function(){e.bkgImage=this,e.generateBackground()},a.src=t}},a.setSphereMapFromUrl=function(t){if(this.sphereMapUrl=this.params.SphereMapUrl=t,""==t)this.sphereMap=null;else{var e=this,a=new JSC3D.Texture;a.onready=function(){e.sphereMap=a,e.update()},a.createFromUrl(this.sphereMapUrl)}},a.enableDefaultInputHandler=function(t){this.isDefaultInputHandlerEnabled=t},a.setMouseUsage=function(t){this.mouseUsage=t},a.replaceSceneFromUrl=function(t){this.sceneUrl=this.params.SceneUrl=t,this.isFailed=this.isLoaded=!1,this.loadScene()},a.replaceScene=function(t){this.sceneUrl=this.params.SceneUrl="",this.isFailed=!1,this.isLoaded=!0,this.errorMsg="",this.setupScene(t)},a.resetScene=function(){var t=!this.scene||this.scene.isEmpty()?0:this.scene.aabb.lengthOfDiagonal();this.zoomFactor=0==t?1:(this.frameWidth<this.frameHeight?this.frameWidth:this.frameHeight)/t,this.panning=[0,0],this.rotMatrix.identity(),this.rotMatrix.rotateAboutXAxis(this.initRotX),this.rotMatrix.rotateAboutYAxis(this.initRotY),this.rotMatrix.rotateAboutZAxis(this.initRotZ)},a.getScene=function(){return this.scene},a.pick=function(t,e){var a=new JSC3D.PickInfo,r=this.canvas.getBoundingClientRect();t-=r.left,e-=r.top,r=t;var o=e;if(null!=this.selectionBuffer&&t>=0&&this.canvas.width>t&&e>=0&&this.canvas.height>e){switch(this.definition){case"low":r=~~(r/2),o=~~(o/2);break;case"high":r*=2,o*=2;break;case"standard":default:}var i=this.selectionBuffer[o*this.frameWidth+r];if(i>0)for(var s=this.scene.getChildren(),l=0;s.length>l;l++)if(s[l].internalId==i){a.mesh=s[l];break}}return a.canvasX=t,a.canvasY=e,a.mesh&&(a.depth=this.zBuffer[o*this.frameWidth+r]),a},a.doUpdate=function(){(this.needUpdate||this.needRepaint)&&(null!=this.beforeupdate&&"function"==typeof this.beforeupdate&&this.beforeupdate(),this.scene?(this.needUpdate&&null!=this.colorBuffer&&(this.beginScene(),this.render(),this.endScene()),this.paint()):this.drawBackground(),this.needUpdate=this.needRepaint=!1,null!=this.afterupdate&&"function"==typeof this.afterupdate&&this.afterupdate())},a.paint=function(){this.canvasData&&this.ctx.putImageData(this.canvasData,0,0)},a.mouseDownHandler=function(t){if(this.isLoaded){if(this.onmousedown){var e=this.pick(t.clientX,t.clientY);this.onmousedown(e.canvasX,e.canvasY,t.button,e.depth,e.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&(this.buttonStates[t.button]=!0,this.mouseX=t.clientX,this.mouseY=t.clientY)}},a.mouseUpHandler=function(t){if(this.isLoaded){if(this.onmouseup){var e=this.pick(t.clientX,t.clientY);this.onmouseup(e.canvasX,e.canvasY,t.button,e.depth,e.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&(this.buttonStates[t.button]=!1)}},a.mouseMoveHandler=function(t){if(this.isLoaded){if(this.onmousemove){var e=this.pick(t.clientX,t.clientY);this.onmousemove(e.canvasX,e.canvasY,t.button,e.depth,e.mesh)}if(t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled){e=1==this.keyStates[16];var a=1==this.keyStates[17];1==this.buttonStates[0]&&(e&&"default"==this.mouseUsage||"zoom"==this.mouseUsage?this.zoomFactor*=this.mouseY<=t.clientY?1.04:.96:a&&"default"==this.mouseUsage||"pan"==this.mouseUsage?(e="low"==this.definition?.5:"high"==this.definition?2:1,this.panning[0]+=e*(t.clientX-this.mouseX),this.panning[1]+=e*(t.clientY-this.mouseY)):("default"==this.mouseUsage||"rotate"==this.mouseUsage)&&(e=360*(t.clientX-this.mouseX)/this.canvas.height,this.rotMatrix.rotateAboutXAxis(360*(t.clientY-this.mouseY)/this.canvas.width),this.rotMatrix.rotateAboutYAxis(e)),this.mouseX=t.clientX,this.mouseY=t.clientY,this.update())}}},a.mouseWheelHandler=function(t){if(this.isLoaded){if(this.onmousewheel){var e=this.pick(t.clientX,t.clientY);this.onmousewheel(e.canvasX,e.canvasY,t.button,e.depth,e.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&(this.zoomFactor*=0>("firefox"==JSC3D.PlatformInfo.browser?-t.detail:t.wheelDelta)?1.1:.91,this.update())}},a.touchStartHandler=function(t){if(this.isLoaded&&t.touches.length>0){var e=t.touches[0].clientX,a=t.touches[0].clientY;if(this.onmousedown){var r=this.pick(e,a);this.onmousedown(r.canvasX,r.canvasY,0,r.depth,r.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&(this.buttonStates[0]=!0,this.mouseX=e,this.mouseY=a)}},a.touchEndHandler=function(t){if(this.isLoaded){if(this.onmouseup){var e=this.pick(this.mouseX,this.mouseY);this.onmouseup(e.canvasX,e.canvasY,0,e.depth,e.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&(this.buttonStates[0]=!1)}},a.touchMoveHandler=function(t){if(this.isLoaded&&t.touches.length>0){var e=t.touches[0].clientX,a=t.touches[0].clientY;if(this.onmousemove){var r=this.pick(e,a);this.onmousemove(r.canvasX,r.canvasY,0,r.depth,r.mesh)}t.preventDefault(),t.stopPropagation(),this.isDefaultInputHandlerEnabled&&("zoom"==this.mouseUsage?this.zoomFactor*=a>=this.mouseY?1.04:.96:"pan"==this.mouseUsage?(t="low"==this.definition?.5:"high"==this.definition?2:1,this.panning[0]+=t*(e-this.mouseX),this.panning[1]+=t*(a-this.mouseY)):("default"==this.mouseUsage||"rotate"==this.mouseUsage)&&(t=360*(e-this.mouseX)/this.canvas.height,this.rotMatrix.rotateAboutXAxis(360*(a-this.mouseY)/this.canvas.width),this.rotMatrix.rotateAboutYAxis(t)),this.mouseX=e,this.mouseY=a,this.update())}},a.keyDownHandler=function(t){this.isDefaultInputHandlerEnabled&&(this.keyStates[t.keyCode]=!0)},a.keyUpHandler=function(t){this.isDefaultInputHandlerEnabled&&(this.keyStates[t.keyCode]=!1)},a.loadScene=function(){if(this.scene=null,this.isLoaded=!1,""==this.sceneUrl)return!1;var t=this.sceneUrl.lastIndexOf("/");-1==t&&(t=this.sceneUrl.lastIndexOf("\\")),t=this.sceneUrl.substring(t+1);var e=t.lastIndexOf(".");if(-1==e)return!1;if(t=t.substring(e+1),t=JSC3D.LoaderSelector.getLoader(t),!t)return!1;var a=this;return t.onload=function(t){a.setupScene(t)},t.onerror=function(t){a.scene=null,a.isLoaded=!1,a.isFailed=!0,a.errorMsg=t,a.update()},t.onprogress=function(t,e){a.reportProgress(t,e)},t.onresource=function(t){t instanceof JSC3D.Texture&&a.isMipMappingOn&&!t.hasMipmap()&&t.generateMipmaps(),a.update()},t.loadFromUrl(this.sceneUrl),!0},a.setupScene=function(t){if(this.creaseAngle>=0){var e=this.creaseAngle;t.forEachChild(function(t){t.creaseAngle=e})}if(t.init(),!t.isEmpty()){var a=t.aabb.lengthOfDiagonal(),r=this.frameWidth,o=this.frameHeight;this.zoomFactor=0==a?1:(o>r?r:o)/a,this.panning=[0,0]}this.rotMatrix.identity(),this.rotMatrix.rotateAboutXAxis(this.initRotX),this.rotMatrix.rotateAboutYAxis(this.initRotY),this.rotMatrix.rotateAboutZAxis(this.initRotZ),this.scene=t,this.isLoaded=!0,this.isFailed=!1,this.errorMsg="",this.needRepaint=this.needUpdate=!1,this.update()},a.reportProgress=function(t,e){if(this.ctx){this.drawBackground(),this.ctx.save();var a=255-((65280&this.bkgColor1)>>8),r=255-(255&this.bkgColor1);a="#"+(255-((16711680&this.bkgColor1)>>16)).toString(16)+a.toString(16)+r.toString(16),this.ctx.strokeStyle=a,this.ctx.fillStyle=a,a=.38*this.canvas.height,r=this.canvas.width-80,this.ctx.strokeRect(40,a,r,20),this.ctx.fillRect(42,a+2,(r-4)*e,16),this.ctx.font="12px Courier New",this.ctx.textAlign="left",this.ctx.fillText(t,40,a-4,r),this.ctx.restore()}},a.reportError=function(t){if(this.ctx){this.drawBackground(),this.ctx.save();var e=.38*this.canvas.height-4,a=255-((65280&this.bkgColor1)>>8),r=255-(255&this.bkgColor1);this.ctx.fillStyle="#"+(255-((16711680&this.bkgColor1)>>16)).toString(16)+a.toString(16)+r.toString(16),this.ctx.font="16px Courier New",this.ctx.textAlign="left",this.ctx.fillText(t,40,e),this.ctx.restore()}},a.generateBackground=function(){this.bkgImage?this.fillBackgroundWithImage():this.fillGradientBackground()},a.fillGradientBackground=function(){for(var t=this.frameWidth,e=this.frameHeight,a=this.bkgColorBuffer,r=(16711680&this.bkgColor1)>>16,o=(65280&this.bkgColor1)>>8,i=255&this.bkgColor1,s=(16711680&this.bkgColor2)>>16,l=(65280&this.bkgColor2)>>8,n=255&this.bkgColor2,c=0,d=0;e>d;d++)for(var h=255&r+d*(s-r)/e,u=255&o+d*(l-o)/e,f=255&i+d*(n-i)/e,p=0;t>p;p++)a[c++]=h<<16|u<<8|f},a.fillBackgroundWithImage=function(){var t=this.frameWidth,e=this.frameHeight;if(!(0>=this.bkgImage.width||0>=this.bkgImage.height)){var a=!1,r=JSC3D.Texture.cv;if(!r)try{r=document.createElement("canvas"),JSC3D.Texture.cv=r,a=!0}catch(o){return}(r.width!=t||r.height!=e)&&(r.width=t,r.height=e,a=!0);var i=null;try{var s=r.getContext("2d");a||s.clearRect(0,0,t,e),s.drawImage(this.bkgImage,0,0,t,e),i=s.getImageData(0,0,t,e).data}catch(l){return}for(a=this.bkgColorBuffer,t*=e,r=e=0;t>e;e++,r+=4)a[e]=i[r]<<16|i[r+1]<<8|i[r+2]}},a.drawBackground=function(){this.canvasData&&(this.beginScene(),this.endScene(),this.paint())},a.beginScene=function(){for(var t=this.colorBuffer,e=this.zBuffer,a=this.selectionBuffer,r=this.bkgColorBuffer,o=this.frameWidth*this.frameHeight,i=-Number.MAX_VALUE,s=0;o>s;s++)t[s]=r[s],e[s]=i,a[s]=0},a.endScene=function(){var t=this.canvasData.data,e=this.canvas.width,a=this.canvas.height,r=this.colorBuffer,o=this.frameWidth,i=o*this.frameHeight;switch(this.definition){case"low":var s=e>>1,l=o-s,n=0,c=0;for(i=0;a>i;i++){for(var d=0;e>d;d++)o=r[n],t[c]=(16711680&o)>>16,t[c+1]=(65280&o)>>8,t[c+2]=255&o,t[c+3]=255,n+=1&d,c+=4;n+=1&i?l:-s}break;case"high":for(i=c=n=0;a>i;i++){for(d=0;e>d;d++){s=r[n],l=r[n+1];var h=r[n+o],u=r[n+o+1];t[c]=(16711680&s)+(16711680&l)+(16711680&h)+(16711680&u)>>18,t[c+1]=(65280&s)+(65280&l)+(65280&h)+(65280&u)>>10,t[c+2]=(255&s)+(255&l)+(255&h)+(255&u)>>2,t[c+3]=255,n+=2,c+=4}n+=o}break;case"standard":default:for(c=n=0;i>n;n++,c+=4)o=r[n],t[c]=(16711680&o)>>16,t[c+1]=(65280&o)>>8,t[c+2]=255&o,t[c+3]=255}},a.render=function(){if(!this.scene.isEmpty()){var t=this.scene.aabb;this.transformMatrix.identity(),this.transformMatrix.translate(-(t.minX+t.maxX)/2,-(t.minY+t.maxY)/2,-(t.minZ+t.maxZ)/2),this.transformMatrix.multiply(this.rotMatrix),this.transformMatrix.scale(this.zoomFactor,-this.zoomFactor,this.zoomFactor),this.transformMatrix.translate(this.frameWidth/2+this.panning[0],this.frameHeight/2+this.panning[1],0),t=this.sortScene(this.transformMatrix);for(var e=0;t.length>e;e++){var a=t[e];if(!a.isTrivial()&&(JSC3D.Math3D.transformVectors(this.transformMatrix,a.vertexBuffer,a.transformedVertexBuffer),a.visible))switch(this.renderMode){case"point":this.renderPoint(a);break;case"wireframe":this.renderWireframe(a);break;case"flat":this.renderSolidFlat(a);break;case"smooth":this.renderSolidSmooth(a);break;case"texture":a.hasTexture()?this.renderSolidTexture(a):this.renderSolidFlat(a);break;case"textureflat":a.hasTexture()?this.renderTextureFlat(a):this.renderSolidFlat(a);break;case"texturesmooth":a.isEnvironmentCast&&null!=this.sphereMap&&this.sphereMap.hasData()?this.renderSolidSphereMapped(a):a.hasTexture()?this.renderTextureSmooth(a):this.renderSolidSmooth(a);break;default:this.renderSolidFlat(a)}}}},a.sortScene=function(t){for(var e=[],a=this.scene.getChildren(),r=0;a.length>r;r++){var o=a[r];if(!o.isTrivial()){e.push(o);var i=o.aabb.center();JSC3D.Math3D.transformVectors(t,i,i),o.sortKey={depth:i[2],isTransparnt:(o.material?o.material:this.defaultMaterial).transparency>0||(o.hasTexture()?o.texture.hasTransparency:!1)}}}return e.sort(function(t,e){return!t.sortKey.isTransparnt&&e.sortKey.isTransparnt?-1:t.sortKey.isTransparnt&&!e.sortKey.isTransparnt?1:t.sortKey.isTransparnt?t.sortKey.depth-e.sortKey.depth:e.sortKey.depth-t.sortKey.depth}),e},a.renderPoint=function(t){var e=this.frameWidth,a=e-1,r=this.frameHeight-1,o=t.transformedVertexBuffer,i=this.colorBuffer,s=this.zBuffer,l=this.selectionBuffer,n=o.length/3,c=t.internalId;t=t.material?t.material.diffuseColor:this.defaultMaterial.diffuseColor;for(var d=0,h=0;n>d;d++,h+=3){var u=~~(o[h]+.5),f=~~(o[h+1]+.5),p=o[h+2];u>=0&&a>u&&f>=0&&r>f&&(u=f*e+u,p>s[u]&&(s[u]=p,i[u]=t,l[u]=c),u++,p>s[u]&&(s[u]=p,i[u]=t,l[u]=c),u+=a,p>s[u]&&(s[u]=p,i[u]=t,l[u]=c),u++,p>s[u]&&(s[u]=p,i[u]=t,l[u]=c))}},a.renderWireframe=function(t){var e=this.frameWidth,a=e-1,r=this.frameHeight-1,o=t.indexBuffer,i=t.transformedVertexBuffer,s=t.transformedFaceNormalZBuffer,l=this.colorBuffer,n=this.zBuffer,c=this.selectionBuffer,d=t.faceCount,h=t.internalId,u=t.material?t.material.diffuseColor:this.defaultMaterial.diffuseColor;(!s||d>s.length)&&(t.transformedFaceNormalZBuffer=Array(d),s=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,s);for(var f=0,p=0;d>f;){var m=s[f++];if(t.isDoubleSided&&(m=m>0?m:-m),0>m){do;while(-1!=o[p++])}else{var g,v;g=3*o[p++],v=3*o[p++],m=g;for(var S=!1;!S;){var b,w,x,C=~~(i[g]+.5),A=~~(i[g+1]+.5),y=i[g+2],H=~~(i[v]+.5),B=~~(i[v+1]+.5),L=i[v+2],I=H-C,k=B-A,M=L-y;for(Math.abs(I)>Math.abs(k)?(b=I,w=I>0?1:-1,x=0!=I?w*k/I:0,I=0!=I?w*M/I:0):(b=k,x=k>0?1:-1,w=0!=k?x*I/k:0,I=0!=k?x*M/k:0),C=C,A=A,y=y,0>b&&(C=H,A=B,y=L,b=-b,w=-w,x=-x,I=-I),H=0;b>H;H++)C>=0&&a>C&&A>=0&&r>A&&(B=~~A*e+~~C,y>n[B]&&(n[B]=y,l[B]=u,c[B]=h)),C+=w,A+=x,y+=I;v==m?S=!0:(g=v,v=-1!=o[p]?3*o[p++]:m)}p++}}},a.renderSolidFlat=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedFaceNormalZBuffer,s=this.colorBuffer,l=this.zBuffer,n=this.selectionBuffer,c=t.faceCount,d=t.internalId,h=t.material?t.material:this.defaultMaterial,u=h.getPalette(),f=0==h.transparency,p=255*h.transparency,m=255-p;if(1!=h.transparency){(!i||c>i.length)&&(t.transformedFaceNormalZBuffer=Array(c),i=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,i),h=Array(3);for(var g=Array(3),v=Array(3),S=0,b=0;c>S;){var w=i[S++];if(t.isDoubleSided&&(w=w>0?w:-w),0>w){do;while(-1!=r[b++])}else{w=u[~~(255*w)];var x,C,A;x=3*r[b++],C=3*r[b++];do{A=3*r[b++],h[0]=~~(o[x]+.5),g[0]=~~(o[x+1]+.5),v[0]=o[x+2],h[1]=~~(o[C]+.5),g[1]=~~(o[C+1]+.5),v[1]=o[C+2],h[2]=~~(o[A]+.5),g[2]=~~(o[A+1]+.5),v[2]=o[A+2],C=g[0]<g[1]?0:1,C=g[C]<g[2]?C:2;var y=g[0]>g[1]?0:1;y=g[y]>g[2]?y:2;var H=3-y-C;if(C!=y){var B=h[y],L=v[y],I=g[y]-g[C];I=0!=I?I:1;var k=(h[y]-h[C])/I;I=(v[y]-v[C])/I;var M=h[y],W=v[y],D=g[y]-g[H];D=0!=D?D:1;var E=(h[y]-h[H])/D;D=(v[y]-v[H])/D;var F=h[H],N=v[H],P=g[H]-g[C];P=0!=P?P:1;var R=(h[H]-h[C])/P;P=(v[H]-v[C])/P;var _=g[y]*e;for(y=g[y];y>g[C];y--){if(y>=0&&a>y){var T,X,U=~~B,V=L;if(y>g[H]?(T=~~M,X=W):(T=~~F,X=N),U>T){var J;J=U,U=T,T=J,J=V,V=X,X=J}if(0>U&&(U=0),T>=e&&(T=e-1),X=U!=T?(X-V)/(T-U):1,J=_+U,f)for(U=U,V=V;T>=U;U++,V+=X)V>l[J]&&(l[J]=V,s[J]=w,n[J]=d),J++;else for(U=U,V=V;T>U;U++,V+=X){if(V>l[J]){var Y=s[J];s[J]=16711680&(16711680&Y)*p+(16711680&w)*m>>8|65280&(65280&Y)*p+(65280&w)*m>>8|255&(255&Y)*p+(255&w)*m>>8,n[J]=d}J++}}B-=k,L-=I,y>g[H]?(M-=E,W-=D):(F-=R,N-=P),_-=e}}C=A}while(-1!=r[b]);b++}}}},a.renderSolidSmooth=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedVertexNormalZBuffer,s=t.vertexNormalIndexBuffer?t.vertexNormalIndexBuffer:t.indexBuffer,l=t.transformedFaceNormalZBuffer,n=this.colorBuffer,c=this.zBuffer,d=this.selectionBuffer,h=t.faceCount,u=t.internalId,f=t.material?t.material:this.defaultMaterial,p=f.getPalette(),m=0==f.transparency,g=255*f.transparency,v=255-g;if(1!=f.transparency){(!i||i.length<t.vertexNormalBuffer.length/3)&&(t.transformedVertexNormalZBuffer=Array(t.vertexNormalBuffer.length/3),i=t.transformedVertexNormalZBuffer),(!l||h>l.length)&&(t.transformedFaceNormalZBuffer=Array(h),l=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.vertexNormalBuffer,i),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,l),t=t.isDoubleSided,f=Array(3);for(var S=Array(3),b=Array(3),w=Array(3),x=0,C=0;h>x;){var A=l[x++];if(t&&(A=A>0?A:-A),0>A){do;while(-1!=r[C++])}else{var y,H,B,L,I;A=3*r[C],B=s[C],C++,H=3*r[C],L=s[C],C++;do{y=r[C],y=3*y,I=s[C],C++,f[0]=~~(o[A]+.5),S[0]=~~(o[A+1]+.5),b[0]=o[A+2],f[1]=~~(o[H]+.5),S[1]=~~(o[H+1]+.5),b[1]=o[H+2],f[2]=~~(o[y]+.5),S[2]=~~(o[y+1]+.5),b[2]=o[y+2],w[0]=i[B],w[1]=i[L],w[2]=i[I],t&&(0>w[0]&&(w[0]=-w[0]),0>w[1]&&(w[1]=-w[1]),0>w[2]&&(w[2]=-w[2])),H=S[0]<S[1]?0:1,H=S[H]<S[2]?H:2;var k=S[0]>S[1]?0:1;if(k=S[k]>S[2]?k:2,L=3-k-H,H!=k){var M=f[k],W=b[k],D=255*w[k],E=S[k]-S[H];E=0!=E?E:1;var F=(f[k]-f[H])/E,N=(b[k]-b[H])/E;E=255*(w[k]-w[H])/E;var P=f[k],R=b[k],_=255*w[k],T=S[k]-S[L];T=0!=T?T:1;var X=(f[k]-f[L])/T,U=(b[k]-b[L])/T;T=255*(w[k]-w[L])/T;var V=f[L],J=b[L],Y=255*w[L],O=S[L]-S[H];O=0!=O?O:1;var $=(f[L]-f[H])/O,Z=(b[L]-b[H])/O;O=255*(w[L]-w[H])/O;var z=S[k]*e;for(k=S[k];k>S[H];k--){if(k>=0&&a>k){var j,q,Q,K=~~M,G=W,te=D;if(k>S[L]?(j=~~P,q=R,Q=_):(j=~~V,q=J,Q=Y),K>j){var ee;ee=K,K=j,j=ee,ee=G,G=q,q=ee,ee=te,te=Q,Q=ee}if(q=K!=j?(q-G)/(j-K):1,Q=K!=j?(Q-te)/(j-K):1,0>K&&(G-=K*q,te-=K*Q,K=0),j>=e&&(j=e-1),ee=z+K,m)for(K=K,G=G,te=te;j>=K;K++,G+=q,te+=Q)G>c[ee]&&(c[ee]=G,n[ee]=p[te>0?~~te:0],d[ee]=u),ee++;else for(K=K,G=G,te=te;j>K;K++,G+=q,te+=Q){if(G>c[ee]){var ae=p[te>0?~~te:0],re=n[ee];n[ee]=16711680&(16711680&re)*g+(16711680&ae)*v>>8|65280&(65280&re)*g+(65280&ae)*v>>8|255&(255&re)*g+(255&ae)*v>>8,d[ee]=u}ee++}}M-=F,W-=N,D-=E,k>S[L]?(P-=X,R-=U,_-=T):(V-=$,J-=Z,Y-=O),z-=e}}H=y,L=I}while(-1!=r[C]);C++}}}},a.renderSolidTexture=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedFaceNormalZBuffer,s=this.colorBuffer,l=this.zBuffer,n=this.selectionBuffer,c=t.faceCount,d=t.internalId,h=t.texture,u=!h.hasTransparency,f=t.texCoordBuffer,p=t.texCoordIndexBuffer?t.texCoordIndexBuffer:t.indexBuffer,m=h.data,g=h.width,v=g-1,S=h.hasMipmap()?h.mipmaps:null,b=S?h.mipentries:null;(!i||c>i.length)&&(t.transformedFaceNormalZBuffer=Array(c),i=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,i);for(var w=Array(3),x=Array(3),C=Array(3),A=Array(3),y=Array(3),H=0,B=0;c>H;){var L=i[H++];if(t.isDoubleSided&&(L=L>0?L:-L),0>L){do;while(-1!=r[B++])}else{var I,k,M,W,D;if(L=3*r[B],M=2*p[B],B++,I=3*r[B],W=2*p[B],B++,S){if(k=3*r[B],D=2*p[B],g=h.width,w[0]=o[L],x[0]=o[L+1],w[1]=o[I],x[1]=o[I+1],w[2]=o[k],x[2]=o[k+1],A[0]=f[M]*g,y[0]=f[M+1]*g,A[1]=f[W]*g,y[1]=f[W+1]*g,A[2]=f[D]*g,y[2]=f[D+1]*g,m=(w[1]-w[0])*(x[2]-x[0])-(x[1]-x[0])*(w[2]-w[0]),0>m&&(m=-m),m+=1,v=(A[1]-A[0])*(y[2]-y[0])-(y[1]-y[0])*(A[2]-A[0]),0>v&&(v=-v),m=v/m,v=0,b[1]>m)v=0;else if(m>=b[b.length-1])v=b.length-1,g=1;else for(;m>=b[v+1];)v++,g/=2;m=S[v],v=g-1}do{k=3*r[B],D=2*p[B],B++,w[0]=~~(o[L]+.5),x[0]=~~(o[L+1]+.5),C[0]=o[L+2],w[1]=~~(o[I]+.5),x[1]=~~(o[I+1]+.5),C[1]=o[I+2],w[2]=~~(o[k]+.5),x[2]=~~(o[k+1]+.5),C[2]=o[k+2],A[0]=f[M]*g,y[0]=f[M+1]*g,A[1]=f[W]*g,y[1]=f[W+1]*g,A[2]=f[D]*g,y[2]=f[D+1]*g,I=x[0]<x[1]?0:1,I=x[I]<x[2]?I:2;var E=x[0]>x[1]?0:1;if(E=x[E]>x[2]?E:2,W=3-E-I,I!=E){var F=w[E],N=C[E],P=A[E],R=y[E],_=x[E]-x[I];_=0!=_?_:1;var T=(w[E]-w[I])/_,X=(C[E]-C[I])/_,U=(A[E]-A[I])/_;_=(y[E]-y[I])/_;var V=w[E],J=C[E],Y=A[E],O=y[E],$=x[E]-x[W];$=0!=$?$:1;var Z=(w[E]-w[W])/$,z=(C[E]-C[W])/$,j=(A[E]-A[W])/$;$=(y[E]-y[W])/$;var q=w[W],Q=C[W],K=A[W],G=y[W],te=x[W]-x[I];te=0!=te?te:1;var ee=(w[W]-w[I])/te,ae=(C[W]-C[I])/te,re=(A[W]-A[I])/te;te=(y[W]-y[I])/te;var oe=x[E]*e;for(E=x[E];E>x[I];E--){if(E>=0&&a>E){var ie,se,le,ne,ce=~~F,de=N,he=P,ue=R;if(E>x[W]?(ie=~~V,se=J,le=Y,ne=O):(ie=~~q,se=Q,le=K,ne=G),ce>ie){var fe;fe=ce,ce=ie,ie=fe,fe=de,de=se,se=fe,fe=he,he=le,le=fe,fe=ue,ue=ne,ne=fe}if(se=ce!=ie?(se-de)/(ie-ce):1,le=ce!=ie?(le-he)/(ie-ce):1,ne=ce!=ie?(ne-ue)/(ie-ce):1,0>ce&&(de-=ce*se,he-=ce*le,ue-=ce*ne,ce=0),ie>=e&&(ie=e-1),fe=oe+ce,u)for(ce=ce,de=de,he=he,ue=ue;ie>=ce;ce++,de+=se,he+=le,ue+=ne)de>l[fe]&&(l[fe]=de,s[fe]=m[(ue&v)*g+(he&v)],n[fe]=d),fe++;else for(ce=ce,de=de,he=he,ue=ue;ie>ce;ce++,de+=se,he+=le,ue+=ne){if(de>l[fe]){var pe=m[(ue&v)*g+(he&v)],me=s[fe],ge=255&pe>>24,ve=255-ge;s[fe]=16711680&(16711680&me)*ve+(16711680&pe)*ge>>8|65280&(65280&me)*ve+(65280&pe)*ge>>8|255&(255&me)*ve+(255&pe)*ge>>8,n[fe]=d}fe++}}F-=T,N-=X,P-=U,R-=_,E>x[W]?(V-=Z,J-=z,Y-=j,O-=$):(q-=ee,Q-=ae,K-=re,G-=te),oe-=e}}I=k,W=D}while(-1!=r[B]);B++}}},a.renderTextureFlat=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedFaceNormalZBuffer,s=this.colorBuffer,l=this.zBuffer,n=this.selectionBuffer,c=t.faceCount,d=t.internalId,h=t.material?t.material:this.defaultMaterial,u=h.getPalette(),f=t.texture,p=0==h.transparency&&!f.hasTransparency,m=~~(255*(1-h.transparency)),g=t.texCoordBuffer,v=t.texCoordIndexBuffer?t.texCoordIndexBuffer:t.indexBuffer,S=f.data,b=f.width,w=b-1,x=f.hasMipmap()?f.mipmaps:null,C=x?f.mipentries:null;if(1!=h.transparency){(!i||c>i.length)&&(t.transformedFaceNormalZBuffer=Array(c),i=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,i),h=Array(3);for(var A=Array(3),y=Array(3),H=Array(3),B=Array(3),L=0,I=0;c>L;){var k=i[L++];if(t.isDoubleSided&&(k=k>0?k:-k),0>k){do;while(-1!=r[I++])}else{k=u[~~(255*k)];var M,W,D,E,F,N;if(M=3*r[I],E=2*v[I],I++,W=3*r[I],F=2*v[I],I++,x){if(D=3*r[I],N=2*v[I],b=f.width,h[0]=o[M],A[0]=o[M+1],h[1]=o[W],A[1]=o[W+1],h[2]=o[D],A[2]=o[D+1],H[0]=g[E]*b,B[0]=g[E+1]*b,H[1]=g[F]*b,B[1]=g[F+1]*b,H[2]=g[N]*b,B[2]=g[N+1]*b,S=(h[1]-h[0])*(A[2]-A[0])-(A[1]-A[0])*(h[2]-h[0]),0>S&&(S=-S),S+=1,w=(H[1]-H[0])*(B[2]-B[0])-(B[1]-B[0])*(H[2]-H[0]),0>w&&(w=-w),S=w/S,w=0,C[1]>S)w=0;else if(S>=C[C.length-1])w=C.length-1,b=1;else for(;S>=C[w+1];)w++,b/=2;S=x[w],w=b-1}do{D=3*r[I],N=2*v[I],I++,h[0]=~~(o[M]+.5),A[0]=~~(o[M+1]+.5),y[0]=o[M+2],h[1]=~~(o[W]+.5),A[1]=~~(o[W+1]+.5),y[1]=o[W+2],h[2]=~~(o[D]+.5),A[2]=~~(o[D+1]+.5),y[2]=o[D+2],H[0]=g[E]*b,B[0]=g[E+1]*b,H[1]=g[F]*b,B[1]=g[F+1]*b,H[2]=g[N]*b,B[2]=g[N+1]*b,W=A[0]<A[1]?0:1,W=A[W]<A[2]?W:2;var P=A[0]>A[1]?0:1;if(P=A[P]>A[2]?P:2,F=3-P-W,W!=P){var R=h[P],_=y[P],T=H[P],X=B[P],U=A[P]-A[W];U=0!=U?U:1;var V=(h[P]-h[W])/U,J=(y[P]-y[W])/U,Y=(H[P]-H[W])/U;U=(B[P]-B[W])/U;var O=h[P],$=y[P],Z=H[P],z=B[P],j=A[P]-A[F];j=0!=j?j:1;var q=(h[P]-h[F])/j,Q=(y[P]-y[F])/j,K=(H[P]-H[F])/j;j=(B[P]-B[F])/j;var G=h[F],te=y[F],ee=H[F],ae=B[F],re=A[F]-A[W];re=0!=re?re:1;var oe=(h[F]-h[W])/re,ie=(y[F]-y[W])/re,se=(H[F]-H[W])/re;re=(B[F]-B[W])/re;var le=A[P]*e;for(P=A[P];P>A[W];P--){if(P>=0&&a>P){var ne,ce,de,he,ue=~~R,fe=_,pe=T,me=X;if(P>A[F]?(ne=~~O,ce=$,de=Z,he=z):(ne=~~G,ce=te,de=ee,he=ae),ue>ne){var ge;ge=ue,ue=ne,ne=ge,ge=fe,fe=ce,ce=ge,ge=pe,pe=de,de=ge,ge=me,me=he,he=ge}if(ce=ue!=ne?(ce-fe)/(ne-ue):1,de=ue!=ne?(de-pe)/(ne-ue):1,he=ue!=ne?(he-me)/(ne-ue):1,0>ue&&(fe-=ue*ce,pe-=ue*de,me-=ue*he,ue=0),ne>=e&&(ne=e-1),ge=le+ue,p)for(ue=ue,fe=fe,pe=pe,me=me;ne>=ue;ue++,fe+=ce,pe+=de,me+=he){if(fe>l[ge]){l[ge]=fe;var ve=S[(me&w)*b+(pe&w)],Se=((16711680&k)>>16)*((16711680&ve)>>8),be=((65280&k)>>8)*((65280&ve)>>8),we=(255&k)*(255&ve)>>8;s[ge]=16711680&Se|65280&be|255&we,n[ge]=d}ge++}else for(ue=ue,fe=fe,pe=pe,me=me;ne>ue;ue++,fe+=ce,pe+=de,me+=he){if(fe>l[ge]){we=S[(me&w)*b+(pe&w)],ve=s[ge];var xe=(255&we>>24)*(255&m)>>8;if(Se=((16711680&k)>>16)*((16711680&we)>>8),be=((65280&k)>>8)*((65280&we)>>8),we=(255&k)*(255&we)>>8,xe>250)l[ge]=fe;else{var Ce=255-xe;Se=Se*xe+(16711680&ve)*Ce>>8,be=be*xe+(65280&ve)*Ce>>8,we=we*xe+(255&ve)*Ce>>8
}s[ge]=16711680&Se|65280&be|255&we,n[ge]=d}ge++}}R-=V,_-=J,T-=Y,X-=U,P>A[F]?(O-=q,$-=Q,Z-=K,z-=j):(G-=oe,te-=ie,ee-=se,ae-=re),le-=e}}W=D,F=N}while(-1!=r[I]);I++}}}},a.renderTextureSmooth=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedVertexNormalZBuffer,s=t.vertexNormalIndexBuffer?t.vertexNormalIndexBuffer:t.indexBuffer,l=t.transformedFaceNormalZBuffer,n=this.colorBuffer,c=this.zBuffer,d=this.selectionBuffer,h=t.faceCount,u=t.internalId,f=t.material?t.material:this.defaultMaterial,p=f.getPalette(),m=t.texture,g=0==f.transparency&&!m.hasTransparency,v=~~(255*(1-f.transparency)),S=t.texCoordBuffer,b=t.texCoordIndexBuffer?t.texCoordIndexBuffer:t.indexBuffer,w=m.data,x=m.width,C=x-1,A=m.hasMipmap()?m.mipmaps:null,y=A?m.mipentries:null;if(1!=f.transparency){(!i||i.length<t.vertexNormalBuffer.length/3)&&(t.transformedVertexNormalZBuffer=Array(t.vertexNormalBuffer.length/3),i=t.transformedVertexNormalZBuffer),(!l||h>l.length)&&(t.transformedFaceNormalZBuffer=Array(h),l=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.vertexNormalBuffer,i),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,l),t=t.isDoubleSided,f=Array(3);for(var H=Array(3),B=Array(3),L=Array(3),I=Array(3),k=Array(3),M=0,W=0;h>M;){var D=l[M++];if(t&&(D=D>0?D:-D),0>D){do;while(-1!=r[W++])}else{var E,F,N,P,R,_,T,X;if(D=3*r[W],N=2*b[W],_=s[W],W++,F=3*r[W],P=2*b[W],T=s[W],W++,A){if(E=3*r[W],R=2*b[W],x=m.width,f[0]=o[D],H[0]=o[D+1],f[1]=o[F],H[1]=o[F+1],f[2]=o[E],H[2]=o[E+1],I[0]=S[N]*x,k[0]=S[N+1]*x,I[1]=S[P]*x,k[1]=S[P+1]*x,I[2]=S[R]*x,k[2]=S[R+1]*x,w=(f[1]-f[0])*(H[2]-H[0])-(H[1]-H[0])*(f[2]-f[0]),0>w&&(w=-w),w+=1,C=(I[1]-I[0])*(k[2]-k[0])-(k[1]-k[0])*(I[2]-I[0]),0>C&&(C=-C),w=C/w,C=0,y[1]>w)C=0;else if(w>=y[y.length-1])C=y.length-1,x=1;else for(;w>=y[C+1];)C++,x/=2;w=A[C],C=x-1}do{E=r[W],E=3*E,R=2*b[W],X=s[W],W++,f[0]=~~(o[D]+.5),H[0]=~~(o[D+1]+.5),B[0]=o[D+2],f[1]=~~(o[F]+.5),H[1]=~~(o[F+1]+.5),B[1]=o[F+2],f[2]=~~(o[E]+.5),H[2]=~~(o[E+1]+.5),B[2]=o[E+2],I[0]=S[N]*x,k[0]=S[N+1]*x,I[1]=S[P]*x,k[1]=S[P+1]*x,I[2]=S[R]*x,k[2]=S[R+1]*x,L[0]=i[_],L[1]=i[T],L[2]=i[X],t&&(0>L[0]&&(L[0]=-L[0]),0>L[1]&&(L[1]=-L[1]),0>L[2]&&(L[2]=-L[2])),F=H[0]<H[1]?0:1,F=H[F]<H[2]?F:2;var U=H[0]>H[1]?0:1;if(U=H[U]>H[2]?U:2,P=3-U-F,F!=U){T=f[U];var V=B[U],J=I[U],Y=k[U],O=255*L[U],$=H[U]-H[F];$=0!=$?$:1;var Z=(f[U]-f[F])/$,z=(B[U]-B[F])/$,j=(I[U]-I[F])/$,q=(k[U]-k[F])/$;$=255*(L[U]-L[F])/$;var Q=f[U],K=B[U],G=I[U],te=k[U],ee=255*L[U],ae=H[U]-H[P];ae=0!=ae?ae:1;var re=(f[U]-f[P])/ae,oe=(B[U]-B[P])/ae,ie=(I[U]-I[P])/ae,se=(k[U]-k[P])/ae;ae=255*(L[U]-L[P])/ae;var le=f[P],ne=B[P],ce=I[P],de=k[P],he=255*L[P],ue=H[P]-H[F];ue=0!=ue?ue:1;var fe=(f[P]-f[F])/ue,pe=(B[P]-B[F])/ue,me=(I[P]-I[F])/ue,ge=(k[P]-k[F])/ue;ue=255*(L[P]-L[F])/ue;var ve=H[U]*e;for(U=H[U];U>H[F];U--){if(U>=0&&a>U){var Se,be,we,xe,Ce,Ae=~~T,ye=V,He=J,Be=Y,Le=O;if(U>H[P]?(Se=~~Q,be=K,we=G,xe=te,Ce=ee):(Se=~~le,be=ne,we=ce,xe=de,Ce=he),Ae>Se){var Ie;Ie=Ae,Ae=Se,Se=Ie,Ie=ye,ye=be,be=Ie,Ie=He,He=we,we=Ie,Ie=Be,Be=xe,xe=Ie,Ie=Le,Le=Ce,Ce=Ie}if(be=Ae!=Se?(be-ye)/(Se-Ae):1,we=Ae!=Se?(we-He)/(Se-Ae):1,xe=Ae!=Se?(xe-Be)/(Se-Ae):1,Ce=Ae!=Se?(Ce-Le)/(Se-Ae):0,0>Ae&&(ye-=Ae*be,He-=Ae*we,Be-=Ae*xe,Le-=Ae*Ce,Ae=0),Se>=e&&(Se=e-1),Ie=ve+Ae,g)for(Ae=Ae,ye=ye,Le=Le,He=He,Be=Be;Se>=Ae;Ae++,ye+=be,Le+=Ce,He+=we,Be+=xe){if(ye>c[Ie]){c[Ie]=ye;var ke=p[Le>0?~~Le:0],Me=w[(Be&C)*x+(He&C)],We=((16711680&ke)>>16)*((16711680&Me)>>8),De=((65280&ke)>>8)*((65280&Me)>>8);ke=(255&ke)*(255&Me)>>8,n[Ie]=16711680&We|65280&De|255&ke,d[Ie]=u}Ie++}else for(Ae=Ae,ye=ye,Le=Le,He=He,Be=Be;Se>Ae;Ae++,ye+=be,Le+=Ce,He+=we,Be+=xe){if(ye>c[Ie]){ke=p[Le>0?~~Le:0];var Ee=w[(Be&C)*x+(He&C)];Me=n[Ie];var Fe=(255&Ee>>24)*(255&v)>>8;We=((16711680&ke)>>16)*((16711680&Ee)>>8),De=((65280&ke)>>8)*((65280&Ee)>>8),ke=(255&ke)*(255&Ee)>>8,Fe>250?c[Ie]=ye:(Ee=255-Fe,We=We*Fe+(16711680&Me)*Ee>>8,De=De*Fe+(65280&Me)*Ee>>8,ke=ke*Fe+(255&Me)*Ee>>8),n[Ie]=16711680&We|65280&De|255&ke,d[Ie]=u}Ie++}}T-=Z,V-=z,J-=j,Y-=q,O-=$,U>H[P]?(Q-=re,K-=oe,G-=ie,te-=se,ee-=ae):(le-=fe,ne-=pe,ce-=me,de-=ge,he-=ue),ve-=e}}F=E,P=R,T=X}while(-1!=r[W]);W++}}}},a.renderSolidSphereMapped=function(t){var e=this.frameWidth,a=this.frameHeight,r=t.indexBuffer,o=t.transformedVertexBuffer,i=t.transformedVertexNormalBuffer,s=t.vertexNormalIndexBuffer?t.vertexNormalIndexBuffer:t.indexBuffer,l=t.transformedFaceNormalZBuffer,n=this.colorBuffer,c=this.zBuffer,d=this.selectionBuffer,h=t.faceCount,u=t.internalId,f=t.material?t.material:this.defaultMaterial,p=f.getPalette(),m=this.sphereMap,g=m.data;m=m.width;var v=m-1,S=0==f.transparency,b=255*f.transparency,w=255-b;if(1!=f.transparency){(!i||i.length<t.vertexNormalBuffer.length)&&(t.transformedVertexNormalBuffer=Array(t.vertexNormalBuffer.length),i=t.transformedVertexNormalBuffer),(!l||h>l.length)&&(t.transformedFaceNormalZBuffer=Array(h),l=t.transformedFaceNormalZBuffer),JSC3D.Math3D.transformVectors(this.rotMatrix,t.vertexNormalBuffer,i),JSC3D.Math3D.transformVectorZs(this.rotMatrix,t.faceNormalBuffer,l),t=t.isDoubleSided,f=Array(3);for(var x=Array(3),C=Array(3),A=Array(3),y=Array(3),H=Array(3),B=0,L=0;h>B;){var I=l[B++];if(t&&(I=I>0?I:-I),0>I){do;while(-1!=r[L++])}else{var k,M,W,D,E;I=3*r[L],W=3*s[L],L++,k=3*r[L],D=3*s[L],L++;do{M=3*r[L],E=3*s[L],L++,f[0]=~~(o[I]+.5),x[0]=~~(o[I+1]+.5),C[0]=o[I+2],f[1]=~~(o[k]+.5),x[1]=~~(o[k+1]+.5),C[1]=o[k+2],f[2]=~~(o[M]+.5),x[2]=~~(o[M+1]+.5),C[2]=o[M+2],A[0]=i[W],y[0]=i[W+1],H[0]=i[W+2],A[1]=i[D],y[1]=i[D+1],H[1]=i[D+2],A[2]=i[E],y[2]=i[E+1],H[2]=i[E+2],t&&(0>H[0]&&(H[0]=-H[0]),0>H[1]&&(H[1]=-H[1]),0>H[2]&&(H[2]=-H[2])),k=x[0]<x[1]?0:1,k=x[k]<x[2]?k:2;var F=x[0]>x[1]?0:1;if(F=x[F]>x[2]?F:2,D=3-F-k,k!=F){var N=f[F],P=C[F],R=255*H[F],_=(A[F]/2+.5)*m&v,T=(.5-y[F]/2)*m&v,X=x[F]-x[k];X=0!=X?X:1;var U=(f[F]-f[k])/X,V=(C[F]-C[k])/X,J=255*(H[F]-H[k])/X,Y=(A[F]-A[k])/2*m/X;X=(y[k]-y[F])/2*m/X;var O=f[F],$=C[F],Z=255*H[F],z=(A[F]/2+.5)*m&v,j=(.5-y[F]/2)*m&v,q=x[F]-x[D];q=0!=q?q:1;var Q=(f[F]-f[D])/q,K=(C[F]-C[D])/q,G=255*(H[F]-H[D])/q,te=(A[F]-A[D])/2*m/q;q=(y[D]-y[F])/2*m/q;var ee=f[D],ae=C[D],re=255*H[D],oe=(A[D]/2+.5)*m&v,ie=(.5-y[D]/2)*m&v,se=x[D]-x[k];se=0!=se?se:1;var le=(f[D]-f[k])/se,ne=(C[D]-C[k])/se,ce=255*(H[D]-H[k])/se,de=(A[D]-A[k])/2*m/se;se=(y[k]-y[D])/2*m/se;var he=x[F]*e;for(F=x[F];F>x[k];F--){if(F>=0&&a>F){var ue,fe,pe,me,ge,ve=~~N,Se=P,be=R,we=_,xe=T;if(F>x[D]?(ue=~~O,fe=$,pe=Z,me=z,ge=j):(ue=~~ee,fe=ae,pe=re,me=oe,ge=ie),ve>ue){var Ce;Ce=ve,ve=ue,ue=Ce,Ce=Se,Se=fe,fe=Ce,Ce=be,be=pe,pe=Ce,Ce=we,we=me,me=Ce,Ce=xe,xe=ge,ge=Ce}if(fe=ve!=ue?(fe-Se)/(ue-ve):1,pe=ve!=ue?(pe-be)/(ue-ve):1,me=ve!=ue?(me-we)/(ue-ve):1,ge=ve!=ue?(ge-xe)/(ue-ve):1,0>ve&&(Se-=ve*fe,be-=ve*pe,we-=we*me,xe-=xe*ge,ve=0),ue>=e&&(ue=e-1),Ce=he+ve,S)for(ve=ve,Se=Se,be=be,we=we,xe=xe;ue>=ve;ve++,Se+=fe,be+=pe,we+=me,xe+=ge){if(Se>c[Ce]){c[Ce]=Se;var Ae=p[be>0?~~be:0],ye=g[(xe&v)*m+(we&v)],He=((16711680&Ae)>>16)*((16711680&ye)>>8),Be=((65280&Ae)>>8)*((65280&ye)>>8);Ae=(255&Ae)*(255&ye)>>8,n[Ce]=16711680&He|65280&Be|255&Ae,d[Ce]=u}Ce++}else for(ve=ve,Se=Se,be=be,we=we,xe=xe;ue>ve;ve++,Se+=fe,be+=pe,we+=me,xe+=ge){if(Se>c[Ce]){Ae=p[be>0?~~be:0];var Le=g[(xe&v)*m+(we&v)];ye=n[Ce],He=((16711680&Ae)>>16)*((16711680&Le)>>8),Be=((65280&Ae)>>8)*((65280&Le)>>8),Ae=(255&Ae)*(255&Le)>>8,He=He*w+(16711680&ye)*b>>8,Be=Be*w+(65280&ye)*b>>8,Ae=Ae*w+(255&ye)*b>>8,n[Ce]=16711680&He|65280&Be|255&Ae,d[Ce]=u}Ce++}}N-=U,P-=V,R-=J,_-=Y,T-=X,F>x[D]?(O-=Q,$-=K,Z-=G,z-=te,j-=q):(ee-=le,ae-=ne,re-=ce,oe-=de,ie-=se),he-=e}}k=M,D=E}while(-1!=r[L]);L++}}}},a.params=null,a.canvas=null,a.ctx=null,a.canvasData=null,a.bkgColorBuffer=null,a.colorBuffer=null,a.zBuffer=null,a.selectionBuffer=null,a.frameWidth=0,a.frameHeight=0,a.scene=null,a.defaultMaterial=null,a.sphereMap=null,a.isLoaded=!1,a.isFailed=!1,a.errorMsg="",a.needUpdate=!1,a.needRepaint=!1,a.initRotX=0,a.initRotY=0,a.initRotZ=0,a.zoomFactor=1,a.panning=[0,0],a.rotMatrix=null,a.transformMatrix=null,a.sceneUrl="",a.modelColor=13280792,a.bkgColor1=16777215,a.bkgColor2=16777088,a.renderMode="flat",a.definition="standard",a.isMipMappingOn=!1,a.creaseAngle=-180,a.sphereMapUrl="",a.buttonStates=null,a.keyStates=null,a.mouseX=0,a.mouseY=0,a.onmousedown=null,a.onmouseup=null,a.onmousemove=null,a.onmousewheel=null,a.beforeupdate=null,a.afterupdate=null,a.mouseUsage="default",a.isDefaultInputHandlerEnabled=!1,JSC3D.PickInfo=function(){this.canvasY=this.canvasX=0,this.depth=-1/0,this.mesh=null},JSC3D.Scene=function(t){this.name=t||"",this.aabb=null,this.children=[],this.maxChildId=1},a=JSC3D.Scene.prototype,a.init=function(){if(!this.isEmpty()){for(var t=0;this.children.length>t;t++)this.children[t].init();this.aabb||(this.aabb=new JSC3D.AABB,this.calcAABB())}},a.isEmpty=function(){return 0==this.children.length},a.addChild=function(t){t.internalId=this.maxChildId++,this.children.push(t)},a.removeChild=function(t){for(var e=0;this.children.length>e;e++)if(this.children[e]==t){this.children.splice(e,1);break}},a.getChildren=function(){return this.children.slice(0)},a.forEachChild=function(t){if("function"==typeof t)for(var e=0;this.children.length>e&&!t.call(null,this.children[e]);e++);},a.calcAABB=function(){this.aabb.minX=this.aabb.minY=this.aabb.minZ=Number.MAX_VALUE,this.aabb.maxX=this.aabb.maxY=this.aabb.maxZ=-Number.MAX_VALUE;for(var t=0;this.children.length>t;t++){var e=this.children[t];if(!e.isTrivial()){var a=e.aabb.minX,r=e.aabb.minY,o=e.aabb.minZ,i=e.aabb.maxX,s=e.aabb.maxY;e=e.aabb.maxZ,this.aabb.minX>a&&(this.aabb.minX=a),this.aabb.minY>r&&(this.aabb.minY=r),this.aabb.minZ>o&&(this.aabb.minZ=o),i>this.aabb.maxX&&(this.aabb.maxX=i),s>this.aabb.maxY&&(this.aabb.maxY=s),e>this.aabb.maxZ&&(this.aabb.maxZ=e)}}},a.name="",a.aabb=null,a.children=null,a.maxChildId=1,JSC3D.Mesh=function(t,e,a,r,o,i,s,l,n,c,d){this.name=t||"",this.metadata="",this.visible=void 0!=e?e:!0,this.aabb=null,this.vertexBuffer=l||null,this.indexBuffer=n||null,this.faceNormalBuffer=this.vertexNormalIndexBuffer=this.vertexNormalBuffer=null,this.material=a||null,this.texture=r||null,this.faceCount=0,this.creaseAngle=o>=0?o:-180,this.isDoubleSided=i||!1,this.isEnvironmentCast=s||!1,this.internalId=0,this.texCoordBuffer=c||null,this.texCoordIndexBuffer=d||null,this.transformedVertexNormalBuffer=this.transformedFaceNormalZBuffer=this.transformedVertexNormalZBuffer=this.transformedVertexBuffer=null},a=JSC3D.Mesh.prototype,a.init=function(){if(!this.isTrivial()){if(0==this.faceCount&&(this.calcFaceCount(),0==this.faceCount))return;this.aabb||(this.aabb=new JSC3D.AABB,this.calcAABB()),this.faceNormalBuffer||(this.faceNormalBuffer=Array(3*this.faceCount),this.calcFaceNormals()),this.vertexNormalBuffer||(this.creaseAngle>=0?this.calcCreasedVertexNormals():(this.vertexNormalBuffer=Array(this.vertexBuffer.length),this.calcVertexNormals())),this.normalizeFaceNormals(),this.transformedVertexBuffer=Array(this.vertexBuffer.length)}},a.isTrivial=function(){return!this.vertexBuffer||3>this.vertexBuffer.length||!this.indexBuffer||3>this.indexBuffer.length},a.setMaterial=function(t){this.material=t},a.setTexture=function(t){this.texture=t},a.hasTexture=function(){return null!=this.texture&&this.texture.hasData()&&null!=this.texCoordBuffer&&this.texCoordBuffer.length>=2&&(null==this.texCoordIndexBuffer||this.texCoordIndexBuffer.length>=3&&this.texCoordIndexBuffer.length>=this.indexBuffer.length)},a.calcFaceCount=function(){this.faceCount=0;var t=this.indexBuffer;-1!=t[t.length-1]&&t.push(-1);for(var e=0;t.length>e;e++)-1==t[e]&&this.faceCount++},a.calcAABB=function(){for(var t=minY=minZ=Number.MAX_VALUE,e=maxY=maxZ=-Number.MAX_VALUE,a=this.vertexBuffer,r=0;a.length>r;r+=3){var o=a[r],i=a[r+1],s=a[r+2];t>o&&(t=o),o>e&&(e=o),minY>i&&(minY=i),i>maxY&&(maxY=i),minZ>s&&(minZ=s),s>maxZ&&(maxZ=s)}this.aabb.minX=t,this.aabb.minY=minY,this.aabb.minZ=minZ,this.aabb.maxX=e,this.aabb.maxY=maxY,this.aabb.maxZ=maxZ},a.calcFaceNormals=function(){for(var t=this.vertexBuffer,e=this.indexBuffer,a=this.faceNormalBuffer,r=0,o=0;e.length>r;){var i=3*e[r++],s=t[i],l=t[i+1],n=t[i+2];i=3*e[r++];var c=t[i],d=t[i+1],h=t[i+2];i=3*e[r++],c-=s,d-=l,h-=n,s=t[i]-s,l=t[i+1]-l,n=t[i+2]-n,i=d*n-h*l,n=h*s-c*n,c=c*l-d*s,a[o++]=i,a[o++]=n,a[o++]=c;do;while(-1!=e[r++])}},a.normalizeFaceNormals=function(){JSC3D.Math3D.normalizeVectors(this.faceNormalBuffer,this.faceNormalBuffer)},a.calcVertexNormals=function(){this.faceNormalBuffer||(this.faceNormalBuffer=Array(3*this.faceCount),this.calcFaceNormals());for(var t=this.indexBuffer,e=this.faceNormalBuffer,a=this.vertexNormalBuffer,r=0;a.length>r;r++)a[r]=0;this.vertexNormalIndexBuffer=null;for(var o=r=0,i=0;t.length>r;)i=t[r++],-1==i?o+=3:(i=3*i,a[i]+=e[o],a[i+1]+=e[o+1],a[i+2]+=e[o+2]);JSC3D.Math3D.normalizeVectors(a,a)},a.calcCreasedVertexNormals=function(){this.faceNormalBuffer||(this.faceNormalBuffer=Array(3*this.faceCount),this.calcFaceNormals());for(var t=this.indexBuffer,e=Array(this.vertexBuffer.length/3),a=0,r=0,o=0,i=0;t.length>r;r++)if(i=t[r],i>=0){a+=3;var s=e[i];s?s.push(o):e[i]=[o]}else o++;o=this.faceNormalBuffer;var l=Array(o.length);for(JSC3D.Math3D.normalizeVectors(o,l),(!this.vertexNormalBuffer||a>this.vertexNormalBuffer.length)&&(this.vertexNormalBuffer=Array(a)),a=this.vertexNormalBuffer,r=0;a.length>r;r++)a[r]=0;for(var n=this.vertexNormalIndexBuffer=[],c=Math.cos(this.creaseAngle*Math.PI/180),d=r=0,h=0;t.length>r;r++)if(i=t[r],i>=0){var u=3*d;s=3*h,a[u]+=o[s],a[u+1]+=o[s+1],a[u+2]+=o[s+2];var f=l[s],p=l[s+1],m=l[s+2];for(s=e[i],i=0;s.length>i;i++){var g=s[i];h!=g&&(g=3*g,f*l[g]+p*l[g+1]+m*l[g+2]>c&&(a[u]+=o[g],a[u+1]+=o[g+1],a[u+2]+=o[g+2]))}n.push(d++)}else h++,n.push(-1);JSC3D.Math3D.normalizeVectors(a,a)},a.checkValid=function(){},a.name="",a.metadata="",a.visible=!1,a.aabb=null,a.vertexBuffer=null,a.indexBuffer=null,a.vertexNormalBuffer=null,a.vertexNormalIndexBuffer=null,a.faceNormalBuffer=null,a.texCoordBuffer=null,a.texCoordIndexBuffer=null,a.material=null,a.texture=null,a.faceCount=0,a.creaseAngle=-180,a.isDoubleSided=!1,a.isEnvironmentCast=!1,a.internalId=0,a.transformedVertexBuffer=null,a.transformedVertexNormalZBuffer=null,a.transformedFaceNormalZBuffer=null,a.transformedVertexNormalBuffer=null,JSC3D.Material=function(t,e,a,r,o){this.name=t||"",this.ambientColor=e||0,this.diffuseColor=a||8355711,this.transparency=r||0,this.simulateSpecular=o||!1,this.palette=null},a=JSC3D.Material.prototype,a.getPalette=function(){return this.palette||(this.palette=Array(256),this.generatePalette()),this.palette},a.generatePalette=function(){var t=(16711680&this.ambientColor)>>16,e=(65280&this.ambientColor)>>8,a=255&this.ambientColor,r=(16711680&this.diffuseColor)>>16,o=(65280&this.diffuseColor)>>8,i=255&this.diffuseColor;if(this.simulateSpecular){for(var s=0;204>s;){var l=t+s*r/204,n=e+s*o/204,c=a+s*i/204;l>255&&(l=255),n>255&&(n=255),c>255&&(c=255),this.palette[s++]=l<<16|n<<8|c}for(;256>s;)l=t+r+(s-204)*(255-r)/82,n=e+o+(s-204)*(255-o)/82,c=a+i+(s-204)*(255-i)/82,l>255&&(l=255),n>255&&(n=255),c>255&&(c=255),this.palette[s++]=l<<16|n<<8|c}else for(s=0;256>s;)l=t+s*r/256,n=e+s*o/256,c=a+s*i/256,l>255&&(l=255),n>255&&(n=255),c>255&&(c=255),this.palette[s++]=l<<16|n<<8|c},a.name="",a.ambientColor=0,a.diffuseColor=8355711,a.transparency=0,a.simulateSpecular=!1,a.palette=null,JSC3D.Texture=function(t,e){this.name=t||"",this.height=this.width=0,this.mipentries=this.mipmaps=this.data=null,this.hasTransparency=!1,this.srcUrl="",this.onready=e&&"function"==typeof e?e:null},a=JSC3D.Texture.prototype,a.createFromUrl=function(t,e){var a=this,r=new Image;r.onload=function(){a.data=null,a.mipmaps=null,a.mipentries=null,a.width=0,a.height=0,a.hasTransparency=!1,a.srcUrl="",a.createFromImage(this,e),JSC3D.console&&JSC3D.console.logInfo('Finished loading texture image file "'+this.src+'".')},r.onerror=function(){a.data=null,a.mipmaps=null,a.mipentries=null,a.width=0,a.height=0,a.hasTransparency=!1,a.srcUrl="",JSC3D.console&&JSC3D.console.logWarning('Failed to load texture image file "'+this.src+'". This texture will be discarded.')},r.src=t},a.createFromImage=function(t,e){if(!(0>=t.width||0>=t.height)){var a=!1,r=JSC3D.Texture.cv;if(!r)try{r=document.createElement("canvas"),JSC3D.Texture.cv=r,a=!0}catch(o){return}var i=t.width>t.height?t.width:t.height;i=32>=i?32:64>=i?64:128>=i?128:256>=i?256:512,(r.width!=i||r.height!=i)&&(r.width=r.height=i,a=!0);var s;try{var l=r.getContext("2d");a||l.clearRect(0,0,i,i),l.drawImage(t,0,0,i,i),s=l.getImageData(0,0,i,i).data}catch(n){return}a=s.length/4,this.data=Array(a);for(var c=l=0;a>l;l++,c+=4)r=s[c+3],this.data[l]=r<<24|s[c]<<16|s[c+1]<<8|s[c+2],255>r&&(this.hasTransparency=!0);this.height=this.width=i,this.mipmaps=null,e&&this.generateMipmaps(),this.srcUrl=t.src,null!=this.onready&&"function"==typeof this.onready&&this.onready()}},a.hasData=function(){return null!=this.data},a.generateMipmaps=function(){if(!(1>=this.width||null==this.data||null!=this.mipmaps)){this.mipmaps=[this.data],this.mipentries=[1];for(var t=1+~~(.1+Math.log(this.width)*Math.LOG2E),e=this.width>>1,a=1;t>a;a++){for(var r=Array(e*e),o=this.mipmaps[a-1],i=e<<1,s=0,l=0,n=0;e>n;n++){for(var c=0;e>c;c++){var d=o[s],h=o[s+1],u=o[s+i],f=o[s+i+1];r[l]=(4278190080&((4278190080&d)>>>2)+((4278190080&h)>>>2)+((4278190080&u)>>>2)+((4278190080&f)>>>2))+(16711680&(16711680&d)+(16711680&h)+(16711680&u)+(16711680&f)>>2)+(65280&(65280&d)+(65280&h)+(65280&u)+(65280&f)>>2)+(255&(255&d)+(255&h)+(255&u)+(255&f)>>2),s+=2,l++}s+=i}this.mipmaps.push(r),this.mipentries.push(Math.pow(4,a)),e>>=1}}},a.hasMipmap=function(){return null!=this.mipmaps},a.name="",a.data=null,a.mipmaps=null,a.mipentries=null,a.width=0,a.height=0,a.hasTransparency=!1,a.srcUrl="",a.onready=null,JSC3D.Texture.cv=null,JSC3D.AABB=function(){this.minZ=this.maxZ=this.minY=this.maxY=this.minX=this.maxX=0},JSC3D.AABB.prototype.center=function(){return[(this.minX+this.maxX)/2,(this.minY+this.maxY)/2,(this.minZ+this.maxZ)/2]},JSC3D.AABB.prototype.lengthOfDiagonal=function(){var t=this.maxX-this.minX,e=this.maxY-this.minY,a=this.maxZ-this.minZ;return Math.sqrt(t*t+e*e+a*a)},JSC3D.Matrix3x4=function(){this.m00=1,this.m10=this.m03=this.m02=this.m01=0,this.m11=1,this.m21=this.m20=this.m13=this.m12=0,this.m22=1,this.m23=0},a=JSC3D.Matrix3x4.prototype,a.identity=function(){this.m00=1,this.m10=this.m03=this.m02=this.m01=0,this.m11=1,this.m21=this.m20=this.m13=this.m12=0,this.m22=1,this.m23=0},a.scale=function(t,e,a){this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m20*=a,this.m21*=a,this.m22*=a,this.m23*=a},a.translate=function(t,e,a){this.m03+=t,this.m13+=e,this.m23+=a},a.rotateAboutXAxis=function(t){if(0!=t){t*=Math.PI/180;var e=Math.cos(t);t=Math.sin(t);var a=e*this.m11-t*this.m21,r=e*this.m12-t*this.m22,o=e*this.m13-t*this.m23,i=e*this.m20+t*this.m10,s=e*this.m21+t*this.m11,l=e*this.m22+t*this.m12,n=e*this.m23+t*this.m13;this.m10=e*this.m10-t*this.m20,this.m11=a,this.m12=r,this.m13=o,this.m20=i,this.m21=s,this.m22=l,this.m23=n}},a.rotateAboutYAxis=function(t){if(0!=t){t*=Math.PI/180;var e=Math.cos(t);t=Math.sin(t);var a=e*this.m01+t*this.m21,r=e*this.m02+t*this.m22,o=e*this.m03+t*this.m23,i=e*this.m20-t*this.m00,s=e*this.m21-t*this.m01,l=e*this.m22-t*this.m02,n=e*this.m23-t*this.m03;this.m00=e*this.m00+t*this.m20,this.m01=a,this.m02=r,this.m03=o,this.m20=i,this.m21=s,this.m22=l,this.m23=n}},a.rotateAboutZAxis=function(t){if(0!=t){t*=Math.PI/180;var e=Math.cos(t);t=Math.sin(t);var a=e*this.m10+t*this.m00,r=e*this.m11+t*this.m01,o=e*this.m12+t*this.m02,i=e*this.m13+t*this.m03,s=e*this.m01-t*this.m11,l=e*this.m02-t*this.m12,n=e*this.m03-t*this.m13;this.m00=e*this.m00-t*this.m10,this.m01=s,this.m02=l,this.m03=n,this.m10=a,this.m11=r,this.m12=o,this.m13=i}},a.multiply=function(t){var e=t.m00*this.m01+t.m01*this.m11+t.m02*this.m21,a=t.m00*this.m02+t.m01*this.m12+t.m02*this.m22,r=t.m00*this.m03+t.m01*this.m13+t.m02*this.m23+t.m03,o=t.m10*this.m00+t.m11*this.m10+t.m12*this.m20,i=t.m10*this.m01+t.m11*this.m11+t.m12*this.m21,s=t.m10*this.m02+t.m11*this.m12+t.m12*this.m22,l=t.m10*this.m03+t.m11*this.m13+t.m12*this.m23+t.m13,n=t.m20*this.m00+t.m21*this.m10+t.m22*this.m20,c=t.m20*this.m01+t.m21*this.m11+t.m22*this.m21,d=t.m20*this.m02+t.m21*this.m12+t.m22*this.m22,h=t.m20*this.m03+t.m21*this.m13+t.m22*this.m23+t.m23;this.m00=t.m00*this.m00+t.m01*this.m10+t.m02*this.m20,this.m01=e,this.m02=a,this.m03=r,this.m10=o,this.m11=i,this.m12=s,this.m13=l,this.m20=n,this.m21=c,this.m22=d,this.m23=h},JSC3D.Math3D={transformVectors:function(t,e,a){for(var r=0;e.length>r;r+=3){var o=e[r],i=e[r+1],s=e[r+2];a[r]=t.m00*o+t.m01*i+t.m02*s+t.m03,a[r+1]=t.m10*o+t.m11*i+t.m12*s+t.m13,a[r+2]=t.m20*o+t.m21*i+t.m22*s+t.m23}},transformVectorZs:function(t,e,a){for(var r=e.length/3,o=0,i=0;r>o;)a[o]=t.m20*e[i]+t.m21*e[i+1]+t.m22*e[i+2]+t.m23,o++,i+=3},normalizeVectors:function(t,e){for(var a=t.length,r=0;a>r;r+=3){var o=t[r],i=t[r+1],s=t[r+2],l=Math.sqrt(o*o+i*i+s*s);l>0&&(l=1/l,o*=l,i*=l,s*=l),e[r]=o,e[r+1]=i,e[r+2]=s}}},JSC3D.PlatformInfo=function(){for(var t,e={browser:"other",version:"0.0.0",isTouchDevice:void 0!=document.createTouch},a=[["firefox",/Firefox[\/\s](\d+(?:.\d+)*)/],["chrome",/Chrome[\/\s](\d+(?:.\d+)*)/],["opera",/Opera[\/\s](\d+(?:.\d+)*)/],["safari",/Safari[\/\s](\d+(?:.\d+)*)/],["webkit",/AppleWebKit[\/\s](\d+(?:.\d+)*)/],["ie",/MSIE[\/\s](\d+(?:.\d+)*)/]],r=0;a.length>r;r++)if(t=a[r][1].exec(window.navigator.userAgent)){e.browser=a[r][0],e.version=t[1];break}return e}(),JSC3D.BinaryStream=function(t,e){if(e)throw"JSC3D.BinaryStream constructor failed: Big endian is not supported yet!";this.data=t,this.offset=0},a=JSC3D.BinaryStream.prototype,a.size=function(){return this.data.length},a.tell=function(){return this.offset},a.seek=function(t){return 0>t||t>=this.data.length?!1:(this.offset=t,!0)},a.reset=function(){this.offset=0},a.skip=function(t){this.offset+t>this.data.length?this.offset=this.data.length:this.offset+=t},a.available=function(){return this.data.length-this.offset},a.eof=function(){return!(this.offset<this.data.length)},a.readUInt8=function(){return this.decodeInt(1,!1)},a.readInt8=function(){return this.decodeInt(1,!0)},a.readUInt16=function(){return this.decodeInt(2,!1)},a.readInt16=function(){return this.decodeInt(2,!0)},a.readUInt32=function(){return this.decodeInt(4,!1)},a.readInt32=function(){return this.decodeInt(4,!0)},a.readFloat32=function(){return this.decodeFloat(4,23)},a.readFloat64=function(){return this.decodeFloat(8,52)},a.readBytes=function(t,e){var a=e;for(this.offset+e>this.data.length&&(a=this.data.length-this.offset),e=0;a>e;e++)t[e]=255&this.data[this.offset++].charCodeAt(0);return a},a.decodeInt=function(t,e){if(this.offset+t>this.data.length)return this.offset=this.data.length,0/0;for(var a=0,r=1,o=0;t>o;o++)a+=(255&this.data[this.offset++].charCodeAt(0))*r,r*=256;return e&&a&Math.pow(2,8*t-1)&&(a-=Math.pow(2,8*t)),a},a.decodeFloat=function(t,e){if(this.offset+t>this.data.length)return this.offset=this.data.length,0/0;var a=8*t-e-1,r=(1<<a)-1,o=r>>1,i=t-1,s=255&this.data[this.offset+i].charCodeAt(0);i+=-1;var l=-7,n=s&(1<<-l)-1;for(s>>=-l,l+=a;l>0;)n=256*n+(255&this.data[this.offset+i].charCodeAt(0)),i+=-1,l-=8;for(a=n&(1<<-l)-1,n>>=-l,l+=e;l>0;)a=256*a+(255&this.data[this.offset+i].charCodeAt(0)),i+=-1,l-=8;switch(this.offset+=t,n){case 0:n=1-o;break;case r:return a?0/0:1/0*(s?-1:1);default:a+=Math.pow(2,e),n-=o}return(s?-1:1)*a*Math.pow(2,n-e)},JSC3D.LoaderSelector={registerLoader:function(t,e){"function"==typeof e&&(JSC3D.LoaderSelector.loaderTable[t]=e)},getLoader:function(t){if(t=JSC3D.LoaderSelector.loaderTable[t.toLowerCase()],!t)return null;var e;try{e=new t}catch(a){e=null}return e},loaderTable:{}},JSC3D.ObjLoader=function(t,e,a,r){this.onload=t&&"function"==typeof t?t:null,this.onerror=e&&"function"==typeof e?e:null,this.onprogress=a&&"function"==typeof a?a:null,this.onresource=r&&"function"==typeof r?r:null,this.requestCount=0},a=JSC3D.ObjLoader.prototype,a.loadFromUrl=function(t){var e="",a=t,r=t.lastIndexOf("/");-1==r&&(r=t.lastIndexOf("\\")),-1!=r&&(e=t.substring(0,r+1),a=t.substring(r+1)),this.requestCount=0,this.loadObjFile(e,a)},a.loadObjFile=function(t,e){var a=t+e,r=this;e=new XMLHttpRequest,e.open("GET",a,!0),e.onreadystatechange=function(){if(4==this.readyState)if(200==this.status||0==this.status){if(r.onload){r.onprogress&&r.onprogress("Loading obj file ...",1),JSC3D.console&&JSC3D.console.logInfo('Finished loading obj file "'+a+'".');var e=new JSC3D.Scene,o=r.parseObj(e,this.responseText);if(o.length>0)for(var i=0;o.length>i;i++)r.loadMtlFile(e,t,o[i]);0==--r.requestCount&&r.onload(e)}}else JSC3D.console&&JSC3D.console.logError('Failed to load obj file "'+a+'".'),r.onerror&&(r.requestCount--,r.onerror('Failed to load obj file "'+a+'".'))},this.onprogress&&(this.onprogress("Loading obj file ...",0),e.onprogress=function(t){r.onprogress("Loading obj file ...",t.position/t.totalSize)}),this.requestCount++,e.send()},a.loadMtlFile=function(t,e,a){var r=e+a,o=this,i=new XMLHttpRequest;i.open("GET",r,!0),i.onreadystatechange=function(){if(4==this.readyState){if(200==this.status||0==this.status){o.onprogress&&o.onprogress("Loading mtl file ...",1),JSC3D.console&&JSC3D.console.logInfo('Finished loading mtl file "'+r+'".');for(var i=o.parseMtl(this.responseText),s={},l=t.getChildren(),n=0;l.length>n;n++){var c=l[n];if(null!=c.mtl&&null!=c.mtllib&&c.mtllib==a){var d=i[c.mtl];null!=d&&(null!=d.material&&c.setMaterial(d.material),""!=d.textureFileName&&(s[d.textureFileName]?s[d.textureFileName].push(c):s[d.textureFileName]=[c]))}}for(var h in s)o.setupTexture(s[h],e+h)}else JSC3D.console&&JSC3D.console.logWarning('Failed to load mtl file "'+r+'". A default material will be applied.');0==--o.requestCount&&o.onload(t)}},this.onprogress&&(this.onprogress("Loading mtl file ...",0),i.onprogress=function(t){o.onprogress("Loading mtl file ...",t.position/t.totalSize)}),this.requestCount++,i.send()},a.parseObj=function(t,e){var a={},r=[],o=0,i=null,s="",l="",n=[],c=[];i="obj-"+o++;var d=new JSC3D.Mesh;d.name=i,d.indexBuffer=[],i=a.nomtl=d;var h=e.split(/[ \t]*\r?\n[ \t]*/);for(e=0;h.length>e;e++)if(l=h[e].split(/[ \t]+/),l.length>0)switch(l[0]){case"v":if(l.length>3)for(var u=1;4>u;u++)n.push(parseFloat(l[u]));break;case"vn":break;case"vt":l.length>2&&(c.push(parseFloat(l[1])),c.push(1-parseFloat(l[2])));break;case"f":if(l.length>3){for(u=1;l.length>u;u++){var f=l[u].split("/");i.indexBuffer.push(parseInt(f[0])-1),f.length>1&&""!=f[1]&&(i.texCoordIndexBuffer||(i.texCoordIndexBuffer=[]),i.texCoordIndexBuffer.push(parseInt(f[1])-1))}i.indexBuffer.push(-1),i.texCoordIndexBuffer&&i.texCoordIndexBuffer.push(-1)}break;case"mtllib":l.length>1?(s=l[1],r.push(s)):s="";break;case"usemtl":l.length>1&&""!=l[1]&&""!=s?(l=l[1],u=s+"-"+l,i=a[u],i||(i=new JSC3D.Mesh,i.name="obj-"+o++,i.indexBuffer=[],i.mtllib=s,i.mtl=l,a[u]=i),i=i):i=d;break;case"#":default:}o=n.length>=3?Array(n.length/3):null,s=c.length>=2?Array(c.length/2):null;for(var p in a){if(i=a[p],n.length>=3&&i.indexBuffer.length>0){for(e=0;o.length>e;e++)o[e]=-1;for(i.vertexBuffer=[],e=h=d=0;i.indexBuffer.length>e;e++)d=i.indexBuffer[e],-1!=d&&(-1==o[d]?(l=3*d,i.vertexBuffer.push(n[l]),i.vertexBuffer.push(n[l+1]),i.vertexBuffer.push(n[l+2]),i.indexBuffer[e]=h,o[d]=h,h++):i.indexBuffer[e]=o[d])}if(c.length>=2&&null!=i.texCoordIndexBuffer&&i.texCoordIndexBuffer.length>0){for(e=0;s.length>e;e++)s[e]=-1;for(i.texCoordBuffer=[],e=h=d=0;i.texCoordIndexBuffer.length>e;e++)d=i.texCoordIndexBuffer[e],-1!=d&&(-1==s[d]?(l=2*d,i.texCoordBuffer.push(c[l]),i.texCoordBuffer.push(c[l+1]),i.texCoordIndexBuffer[e]=h,s[d]=h,h++):i.texCoordIndexBuffer[e]=s[d])}i.isTrivial()||t.addChild(i)}return r},a.parseMtl=function(t){var e={},a="";t=t.split(/[ \t]*\r?\n[ \t]*/);for(var r=0;t.length>r;r++){var o=t[r].split(/[ \t]+/);if(o.length>0)switch(o[0]){case"newmtl":a=o[1],o={},o.material=new JSC3D.Material,o.textureFileName="",e[a]=o;break;case"Ka":break;case"Kd":if(4==o.length&&!isNaN(o[1])){var i=255&255*parseFloat(o[1]),s=255&255*parseFloat(o[2]),l=255&255*parseFloat(o[3]);o=e[a],null!=o&&(o.material.diffuseColor=i<<16|s<<8|l)}break;case"Ks":break;case"d":2!=o.length||isNaN(o[1])||(i=parseFloat(o[1]),o=e[a],null!=o&&(o.material.transparency=1-i));break;case"illum":break;case"map_Kd":2==o.length&&(i=o[1],o=e[a],null!=o&&(o.textureFileName=i));break;case"#":default:}}return e},a.setupTexture=function(t,e){var a=this,r=new JSC3D.Texture;r.onready=function(){for(var e=0;t.length>e;e++)t[e].setTexture(this);a.onresource&&a.onresource(this)},r.createFromUrl(e)},a.onload=null,a.onerror=null,a.onprogress=null,a.onresource=null,a.requestCount=0,JSC3D.LoaderSelector.registerLoader("obj",JSC3D.ObjLoader),JSC3D.StlLoader=function(t,e,a,r){this.onload=t&&"function"==typeof t?t:null,this.onerror=e&&"function"==typeof e?e:null,this.onprogress=a&&"function"==typeof a?a:null,this.onresource=r&&"function"==typeof r?r:null,this.decimalPrecision=3},a=JSC3D.StlLoader.prototype,a.loadFromUrl=function(t){var e=this,a="ie"==JSC3D.PlatformInfo.browser,r=new XMLHttpRequest;r.open("GET",t,!0),a?r.setRequestHeader("Accept-Charset","x-user-defined"):r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(){if(4==this.readyState)if(200==this.status||0==this.status){if(JSC3D.console&&JSC3D.console.logInfo('Finished loading STL file "'+t+'".'),e.onload){if(e.onprogress&&e.onprogress("Loading STL file ...",1),a){var r=new JSC3D.Scene;try{e.parseStl(r,function(t){for(var e="",a=0;t.length-65536>a;a+=65536)e+=String.fromCharCode.apply(null,t.slice(a,a+65536));return e+String.fromCharCode.apply(null,t.slice(a))}(new VBArray(this.responseBody).toArray()))}catch(o){}}else r=new JSC3D.Scene,e.parseStl(r,this.responseText);e.onload(r)}}else JSC3D.console&&JSC3D.console.logError('Failed to load STL file "'+t+'".'),e.onerror&&e.onerror('Failed to load STL file "'+t+'".')},this.onprogress&&(this.onprogress("Loading STL file ...",0),r.onprogress=function(t){e.onprogress("Loading STL file ...",t.position/t.totalSize)}),r.send()},a.setDecimalPrecision=function(t){this.decimalPrecision=t},a.parseStl=function(t,e){var a=new JSC3D.Mesh;a.vertexBuffer=[],a.indexBuffer=[],a.faceNormalBuffer=[];var r=!1,o=new JSC3D.BinaryStream(e);o.skip(84);for(var i=0;256>i&&!o.eof();i++)if(o.readUInt8()>127){r=!0;break}if(JSC3D.console&&JSC3D.console.logInfo("This is recognised as "+(r?"a binary":"an ASCII")+" STL file."),r){if(o.reset(),o.skip(80),r=o.readUInt32(),e=84+50*r,e>o.size())return JSC3D.console&&JSC3D.console.logError("Failed to parse contents of the file. It seems not complete."),void 0;for(a.faceCount=r,s={},i=0;r>i;i++){for(a.faceNormalBuffer.push(o.readFloat32()),a.faceNormalBuffer.push(o.readFloat32()),a.faceNormalBuffer.push(o.readFloat32()),e=0;3>e;e++)l=o.readFloat32(),n=o.readFloat32(),c=o.readFloat32(),d=l.toFixed(this.decimalPrecision)+"-"+n.toFixed(this.decimalPrecision)+"-"+c.toFixed(this.decimalPrecision),h=s[d],void 0==h&&(h=a.vertexBuffer.length/3,s[d]=h,a.vertexBuffer.push(l),a.vertexBuffer.push(n),a.vertexBuffer.push(c)),a.indexBuffer.push(h);a.indexBuffer.push(-1),o.skip(2)}}else if(o=RegExp("facet\\s+normal\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+outer\\s+loop\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+endloop\\s+endfacet","ig"),i=e.match(o)){r=i.length,a.faceCount=r;var s={};for(o.lastIndex=0,o.global=!1,r=o.exec(e);null!=r;r=o.exec(e)){for(a.faceNormalBuffer.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])),i=0;3>i;i++){var l=parseFloat(r[4+3*i]),n=parseFloat(r[5+3*i]),c=parseFloat(r[6+3*i]),d=l.toFixed(this.decimalPrecision)+"-"+n.toFixed(this.decimalPrecision)+"-"+c.toFixed(this.decimalPrecision),h=s[d];
void 0===h&&(h=a.vertexBuffer.length/3,s[d]=h,a.vertexBuffer.push(l),a.vertexBuffer.push(n),a.vertexBuffer.push(c)),a.indexBuffer.push(h)}a.indexBuffer.push(-1)}}a.isTrivial()||(1e-6>Math.abs(a.faceNormalBuffer[0])&&1e-6>Math.abs(a.faceNormalBuffer[1])&&1e-6>Math.abs(a.faceNormalBuffer[2])&&(a.faceNormalBuffer=null),t.addChild(a))},a.onload=null,a.onerror=null,a.onprogress=null,a.onresource=null,a.decimalPrecision=3,JSC3D.LoaderSelector.registerLoader("stl",JSC3D.StlLoader),$(document).ready(function(){var t=new HomeController,e=new AccountValidator;$("#account-form").ajaxForm({beforeSubmit:function(t){return 0==e.validateForm()?!1:(t.push({name:"user",value:$("#user-tf").val()}),!0)},success:function(e,a){"success"==a&&t.onUpdateSuccess()},error:function(t){"email-taken"==t.responseText?e.showInvalidEmail():"username-taken"==t.responseText&&e.showInvalidUserName()}}),$("#name-tf").focus(),$("#github-banner").css("top","41px"),$("#account-form h1").text("Account Settings"),$("#account-form #sub1").text("Here are the current settings for your account."),$("#user-tf").attr("disabled","disabled"),$("#account-form-btn1").html("Delete"),$("#account-form-btn1").addClass("btn-danger"),$("#account-form-btn2").html("Update"),$(".modal-confirm").modal({show:!1,keyboard:!0,backdrop:!0}),$(".modal-confirm .modal-header h3").text("Delete Account"),$(".modal-confirm .modal-body p").html("Are you sure you want to delete your account?"),$(".modal-confirm .cancel").html("Cancel"),$(".modal-confirm .submit").html("Delete"),$(".modal-confirm .submit").addClass("btn-danger")}),$(document).ready(function(){var t=new LoginValidator;new LoginController,$("#login-form").ajaxForm({beforeSubmit:function(e){return 0==t.validateForm()?!1:(e.push({name:"remember-me",value:1==$("input:checkbox:checked").length}),!0)},success:function(t,e){"success"==e&&(window.location.href="/home")},error:function(){t.showLoginError("Login Failure","Please check your username and/or password")}}),$("#user-tf").focus();var e=new EmailValidator;$("#get-credentials-form").ajaxForm({url:"/lost-password",beforeSubmit:function(){return e.validateEmail($("#email-tf").val())?(e.hideEmailAlert(),!0):(e.showEmailAlert("<b> Error!</b> Please enter a valid email address"),!1)},success:function(){e.showEmailSuccess("Check your email on how to reset your password.")},error:function(){e.showEmailAlert("Sorry. There was a problem, please try again later.")}})}),$(document).ready(function(){var t=new ResetValidator;$("#set-password-form").ajaxForm({beforeSubmit:function(){return t.hideAlert(),0==t.validatePassword($("#pass-tf").val())?!1:!0},success:function(){t.showSuccess("Your password has been reset."),setTimeout(function(){window.location.href="/"},3e3)},error:function(){t.showAlert("I'm sorry something went wrong, please try again.")}}),$("#set-password").modal("show"),$("#set-password").on("shown",function(){$("#pass-tf").focus()})}),$(document).ready(function(){var t=new AccountValidator;new SignupController,$("#account-form").ajaxForm({beforeSubmit:function(){return t.validateForm()},success:function(t,e){"success"==e&&$(".modal-alert").modal("show")},error:function(e){"email-taken"==e.responseText?t.showInvalidEmail():"username-taken"==e.responseText&&t.showInvalidUserName()}}),$("#name-tf").focus(),$("#account-form h1").text("Signup"),$("#account-form #sub1").text("Please tell us a little about yourself"),$("#account-form #sub2").text("Choose your username & password"),$("#account-form-btn1").html("Cancel"),$("#account-form-btn2").html("Submit"),$("#account-form-btn2").addClass("btn-primary"),$(".modal-alert").modal({show:!1,keyboard:!1,backdrop:"static"}),$(".modal-alert .modal-header h3").text("Success!"),$(".modal-alert .modal-body p").html("Your account has been created.</br>Click OK to return to the login page.")}),$(document).viewer=new JSC3D.Viewer(document.getElementById("cv")),viewer.setParameter("SceneUrl"),viewer.setParameter("ModelColor","#CAA618"),viewer.setParameter("BackgroundColor1","#E5D7BA"),viewer.setParameter("BackgroundColor2","#383840"),viewer.setParameter("RenderMode","flat"),viewer.init(),viewer.update();